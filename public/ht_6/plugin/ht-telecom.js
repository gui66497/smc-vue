!function(m,R){"use strict";var Z=ht.AlarmSeverity=function(X,M,m,n,r){this.value=X,this.name=M,this.nickName=m,this.color=n,this.displayName=r};ht.Default.def("ht.AlarmSeverity",R,{toString:function(){return this.displayName||this.name}}),function(){Z.severities=new ht.List,Z._vm={},Z._nm={},Z._cp=function(v,z){if(v&&z){var Q=v.value-z.value;return Q>0?1:0>Q?-1:0}return v&&!z?1:!v&&z?-1:0},Z.each=function(T,h){Z.severities.each(T,h)},Z.getSortFunction=function(){return Z._cp},Z.setSortFunction=function(M){Z._cp=M,Z.severities.sort(M)},Z.add=function(q,L,R,r,k){var o=new Z(q,L,R,r,k);return Z._vm[q]=o,Z._nm[L]=o,Z.severities.add(o),Z.severities.sort(Z._cp),o},Z.remove=function(n){var d=Z._nm[n];return d&&(delete Z._nm[n],delete Z._vm[d.value],Z.severities.remove(d)),d},Z.CRITICAL=Z.add(500,"Critical","C","#FF0000"),Z.MAJOR=Z.add(400,"Major","M","#FFA000"),Z.MINOR=Z.add(300,"Minor","m","#FFFF00"),Z.WARNING=Z.add(200,"Warning","W","#00FFFF"),Z.INDETERMINATE=Z.add(100,"Indeterminate","N","#C800FF"),Z.CLEARED=Z.add(0,"Cleared","R","#00FF00"),Z.isClearedAlarmSeverity=function(D){return D?0===D.value:!1},Z.getByName=function(J){return Z._nm[J]},Z.getByValue=function(l){return Z._vm[l]},Z.clear=function(){Z.severities.clear(),Z._vm={},Z._nm={}},Z.compare=function(V,$){return Z._cp(V,$)}}();var F=ht.AlarmState=function(Z){this._d=Z,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",R,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var t=null;for(var X in this._am)X=Z.getByName(X),Z.isClearedAlarmSeverity(X)||0!==this.getAcknowledgedAlarmCount(X)&&(t=t?Z.compare(t,X)>0?t:X:X);this._haa=t},_c2:function(){var l=null;for(var P in this._nm)P=Z.getByName(P),Z.isClearedAlarmSeverity(P)||0!==this.getNewAlarmCount(P)&&(l=l?Z.compare(l,P)>0?l:P:P);this._hna=l},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var d in this._nm)if(d=Z.getByName(d),!Z.isClearedAlarmSeverity(d)&&0!==this.getNewAlarmCount(d)&&Z.compare(this._hna,d)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var S=this._haa,$=this._hna,j=this._ps;this._hoa=S,Z.compare($,this._hoa)>0&&(this._hoa=$),Z.compare(j,this._hoa)>0&&(this._hoa=j)},_c5:function(){var V=this._haa,X=this._hna;this._hta=V,Z.compare(X,this._hta)>0&&(this._hta=X)},increaseAcknowledgedAlarm:function(X,Z){if(0!==Z){Z=Z||1;var g=this._am[X.name]||0;g+=Z,this._am[X.name]=g,this._f()}},increaseNewAlarm:function(U,y){if(0!==y){y=y||1;var d=this._nm[U.name]||0;d+=y,this._nm[U.name]=d,this._f()}},decreaseAcknowledgedAlarm:function(k,h){if(0!==h){h||(h=1);var W=this._am[k.name]||0;if(W-=h,0>W)throw"Alarm count can not be negative";this._am[k.name]=W,this._f()}},decreaseNewAlarm:function(L,u){if(0!==u){u||(u=1);var F=this._nm[L.name]||0;if(F-=u,0>F)throw"Alarm count can not be negative";this._nm[L.name]=F,this._f()}},acknowledgeAlarm:function(Q){this.decreaseNewAlarm(Q,1),this.increaseAcknowledgedAlarm(Q,1)},acknowledgeAllAlarms:function(L){if(L){var u=this.getNewAlarmCount(L);this.decreaseNewAlarm(L,u),this.increaseAcknowledgedAlarm(L,u)}else for(var U in this._nm)this.acknowledgeAllAlarms(Z.getByName(U))},_c6:function(){this._aac=0;for(var m in this._am)m=Z.getByName(m),this._aac+=this.getAcknowledgedAlarmCount(m)},getAcknowledgedAlarmCount:function(i){return i?this._am[i.name]||0:this._aac},getAlarmCount:function($){return this.getAcknowledgedAlarmCount($)+this.getNewAlarmCount($)},_c7:function(){this._nac=0;for(var h in this._nm)this._nac+=this.getNewAlarmCount(Z.getByName(h))},getNewAlarmCount:function(G){return G?this._nm[G.name]||0:this._nac},setNewAlarmCount:function(e,r){this._nm[e.name]=r,this._f()},removeAllNewAlarms:function(S){S?delete this._nm[S]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(s,W){this._am[s.name]=W,this._f()},removeAllAcknowledgedAlarms:function(T){T?delete this._am[T.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(R){if(this._ep||(R=null),this._ps!==R){var a=this._ps;this._ps=R,this._f(),this._d.fp("propagateSeverity",a,R)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(o){var g=this._ep;this._ep=o,this._d.fp("enablePropagation",g,o)&&(o||this.setPropagateSeverity(null))}});var Q=ht.AlarmStatePropagator=function(m){this._dataModel=m,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",R,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(z){this._enable!==z&&(this._enable=z,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(T){this.propagate(T)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(U){U.data&&this.propagate(U.data)},handleDataPropertyChange:function(j){if("alarmState"===j.property||"enablePropagation"===j.property)this.propagate(j.data);else if("parent"===j.property){var P=j.oldValue;P&&this.propagate(P),this.propagate(j.data)}},propagate:function(d){d&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(d),this._isPropagating=!1)},propagateToTop:function(O){for(this.propagateToParent(null,O);O&&O.getParent();)this.propagateToParent(O,O.getParent()),O=O.getParent()},propagateToParent:function(f,o){var b=null;o.getChildren().each(function(y){var l=y.getAlarmState().getHighestOverallAlarmSeverity();Z.compare(l,b)>0&&(b=l)}),o.getAlarmState().setPropagateSeverity(b)}}),ht.AlarmStateStatistics=function(r){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(r)},ht.Default.def("ht.AlarmStateStatistics",R,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(S){var d=this._dataModel;d!==S&&(d&&(d.umd(this.handleDataPropertyChange,this),d.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=S,this.reset(),S.md(this.handleDataPropertyChange,this),S.mm(this.handleDataModelChange,this),this.fp("dataModel",d,S))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(J){"alarmState"===J.property&&(this.increase(J.data),this.fireAlarmStateChange())},handleDataModelChange:function(t){"add"===t.kind?(this.increase(t.data),this.fireAlarmStateChange()):"remove"===t.kind?(this.decrease(t.data),this.fireAlarmStateChange()):"clear"===t.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,Z.each(function(l){var D=this.getSumInfo(l);this.sumAcked+=D.ackedCount,this.sumNew+=D.newCount,this.sumTotal+=D.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(a){if(!a)return this.sumNew;var j=this.getSumInfo(a);return j.newCount},getAcknowledgedAlarmCount:function(_){if(!_)return this.sumAcked;var n=this.getSumInfo(_);return n.ackedCount},getTotalAlarmCount:function(S){if(!S)return this.sumTotal;var Y=this.getSumInfo(S);return Y.totalCount},getSumInfo:function(c){var $=this.severtiyMap[c.name];return $||($={},$.newCount=0,$.ackedCount=0,$.totalCount=0,this.severtiyMap[c.name]=$),$},decrease:function(v){var o=this.dataMap[v.getId()];o&&(delete this.dataMap[v.getId()],Z.each(function(T){var v=o[T.name],X=this.getSumInfo(T);X.newCount=X.newCount-v.newCount,X.ackedCount=X.ackedCount-v.ackedCount,X.totalCount=X.totalCount-v.totalCount},this))},increase:function(E){if(this.decrease(E),!this._filterFunc||this._filterFunc(E)){var m={},n=E.getAlarmState();this.dataMap[E.getId()]=m,Z.each(function(i){var s={};s.newCount=n.getNewAlarmCount(i),s.ackedCount=n.getAcknowledgedAlarmCount(i),s.totalCount=n.getAlarmCount(i),m[i.name]=s;var B=this.getSumInfo(i);B.newCount=B.newCount+s.newCount,B.ackedCount=B.ackedCount+s.ackedCount,B.totalCount=B.totalCount+s.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(p){var L=this._filterFunc;this._filterFunc=p,this.reset(),this.firePropertyChange("filterFunc",L,p)},getFilterFunc:function(){return this._filterFunc}});var M=ht.Data.prototype;M.getAlarmState=function(){return this._alarmState||(this._alarmState=new F(this))},M=ht.DataModel.prototype,M.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},M.setEnableAlarmStatePropagator=function(N){N!=this.isEnableAlarmStatePropagator()&&(N?(this._alarmStatePropagator=new Q(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},M=ht.graph.GraphView.prototype,M.getNote2=function(G){var N=G.getAlarmState().getHighestNewAlarmSeverity();if(N){var v=G.getAlarmState().getNewAlarmCount(N)+N.nickName;return G.getAlarmState().hasLessSevereNewAlarms()&&(v+="+"),v}return G.s("note2")},M.getNote2Background=function(A){var i=A.getAlarmState().getHighestNewAlarmSeverity();return i?i.color:A.s("note2.background")},M.getBodyColor=function(f){var j=f.getAlarmState().getHighestNativeAlarmSeverity();return j?j.color:f.s("body.color")},M.getBorderColor=function(L){var _=L.getAlarmState().getPropagateSeverity();return _?_.color:L.s("border.color")},M=ht.widget.TreeView.prototype,M.getBorderColor=function(q){var Z=q.getAlarmState().getPropagateSeverity();return Z?Z.color:q.s("border.color")},M.getIcon=function(q){return q.getIcon()?"__alarmIcon__":null},M=ht.widget.TreeTableView.prototype,M.getBorderColor=function(G){var t=G.getAlarmState().getPropagateSeverity();return t?t.color:G.s("border.color")},M.getIcon=function(Z){return Z.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(u){return u.getIcon()}},color:{func:function(w){var $=w.getAlarmState().getHighestNativeAlarmSeverity();return $?$.color:w.s("body.color")}},rect:[0,0,16,16]}]});var L=ht.Style;L["note2.expanded"]=!0,L["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);