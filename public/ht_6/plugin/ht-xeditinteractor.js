!function(x,m,H){"use strict";var V="ht",u=x[V],r=u.Default,k=u.graph,y=r.getInternal(),O=y.ui(),E=O.NodeUI.prototype,T=O.ShapeUI.prototype,l=k.GraphView,J=l.prototype,N=O.EdgeUI.prototype,G=u.Node,P=u.Shape,Y=u.Edge,v=u.Group,a=r.isTouchable,f=r.preventDefault,w=x.setTimeout,n=r.grow,$=r.isDragging,p=r.getDistance,_=null,d=u.List,Q="undefined"!=typeof Float32Array?Float32Array:Array,z=Math,c=z.PI,g="Crossing",s="No Crossing",B=c/2,i=2*c,K=z.atan2,A=z.sqrt,S=z.pow,M=z.sin,h=z.cos,W=z.min,F=z.max,R=z.abs,o=z.ceil,C=z.round,b=r.unionPoint,U=r.unionRect,I=r.containsPoint,t=r.clone,j="rgb(52, 152, 219)",L="red",D={northwest:0,north:1,northeast:2,west:7,east:3,southwest:6,south:5,southeast:4},X={width:400,height:100,comps:[{type:"shape",points:{func:function(){for(var Z=[10,8,162,36,314,37,269,2,398,49,268,98,314,58,161,60,9,91,103,49,10,8],h=0;h<Z.length;h++){var P=Z[h];P=0===h%2?P/400*X.width:P/100*X.height,Z[h]=P}return X.width>120&&(Z[4]=X.width-26,Z[6]=X.width-40,Z[10]=X.width-40,Z[12]=X.width-26,Z[18]=33),Z}},segments:[1,3,2,2,2,2,3,2,2],background:"white",gradient:"linear.east",gradientColor:"red"}]},q={width:300,height:300,comps:[{type:"circle",rect:[20,0,120,120],background:j,rotation:.61},{type:"circle",rect:[200,120,70,70],background:j,rotation:.61},{type:"circle",rect:[200,220,70,70],background:j,rotation:.61},{type:"shape",points:[80,60,80,155,200,155],borderWidth:20,borderColor:j},{type:"shape",points:[80,60,80,255,200,255],borderWidth:20,borderColor:j}]},e={width:300,height:300,comps:[{type:"shape",points:[114,239,115,106,112,73,149,73,149,73,175,73,177,105,179,261,178,302,147,307,98,308,83,307,72,276,73,260,72,81,74,29,115,21,191,21,221,22,224,53,223,238],segments:[1,2,3,2,3,2,3,2,4,2,3,2,3,2],borderWidth:20,borderColor:L,rotation:.61}]},Z={width:300,height:300,comps:[{type:"circle",rect:[210,0,90,90],background:j},{type:"circle",rect:[0,210,90,90],background:j},{type:"shape",points:[255,45,45,255],borderWidth:20,borderColor:j}]},Hg={width:300,height:300,comps:[{type:"shape",points:[20,20,280,280],borderWidth:30,borderColor:L},{type:"shape",points:[280,20,20,280],borderWidth:30,borderColor:L}]},Tl={width:300,height:300,comps:[{type:"shape",points:[270,30,30,150,270,270],borderWidth:40,borderColor:j}]},yl={width:300,height:300,comps:[{type:"shape",points:[30,30,270,150,30,270],borderWidth:40,borderColor:L}]},zh={width:300,height:300,comps:[{type:"rect",rect:[125.58,52.76,40,231.96],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[27.87,61.06,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:5.5},{type:"rect",rect:[113.36,61,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:.79}]},Rq={width:300,height:300,author:"",note:"",comps:[{type:"rect",rect:[135.15,38.76,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,2.35,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,115.72,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,167.62,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[135.15,177.33,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,251.39,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:3.14}]},Up=function(n){var l=n.touches[0];return l?l:n.changedTouches[0]},_d=function(I,q,_,i){return K(i-q,_-I)},He=function(q,Z){return{x:q.x*Z,y:q.y*Z}},bk=function(M,$){var w,E,c,U,F=M._layers,Q=M.sm().getSelection()._as,r=Q.length;if(F)for(w=0;w<F.length;w++){U=F[w];for(var L=0;r>L;L++)if(E=Q[L],E._layer===U&&(c=$(E),c===!1))return}else for(w=0;r>w;w++)if(E=Q[w],c=$(E),c===!1)return},xd=function(k,J,p){var z,T,j,b,M,Y=this,U=J,r=Y.gv;if(k instanceof P){j=k.getSegments();var w=r.getDataUI(k);M=w._55O.$15l,j&&j.size()||(j=bg(M)),k.isClosePath()&&j.indexOf(5)<0&&(j=new d(j._as),j.add(5)),z=Ej(k,w,U),T=M[z]}else{var D=r.getDataUI(k);M=Yf(D,k.s("edge.points")),j=k.s("edge.segments"),j&&j.size()||(j=bg(M)),M=M._as,z=Ej(k,D,U),T=M[z]}if(j&&(b=j.get(U)),2===b||1===b||5===b){var G=M[z+1];5===b&&(G=M[0]);var i=xj(T,p,G);return i}return p},bi=function(I,P){var L,j,Q,A,D=I._layers,N=I.sm().getSelection()._as,l=N.length;if(D)for(L=D.length-1;L>=0;L--){A=D[L];for(var _=l-1;_>=0;_--)if(j=N[_],j._layer===A&&(Q=P(j),Q===!1))return}else for(L=l-1;L>=0;L--)if(j=N[L],Q=P(j),Q===!1)return},Eq=function(p,u,M,g){var r=u/2,F=M/2,v=Lj(p,-r,-F,g),z=Lj(p,r,-F,g),x=Lj(p,-r,F,g),H=Lj(p,r,F,g),Q=Lj(p,0,-F,g),X=Lj(p,r,0,g),q=Lj(p,0,F,g),t=Lj(p,-r,0,g);return[v,z,x,H,Q,X,q,t]},xj=function(X,P,z){var T={x:P.x-X.x,y:P.y-X.y},B={x:z.x-X.x,y:z.y-X.y},u=A(S(z.x-X.x,2)+S(z.y-X.y,2)),p={x:B.x/u,y:B.y/u},Y=T.x*p.x+T.y*p.y,g={x:p.x*Y,y:p.y*Y};return{x:X.x+g.x,y:X.y+g.y}},Lj=function(N,q,$,c){var I=h(c)*q-M(c)*$,Q=M(c)*q+h(c)*$;return N?{x:N.x+I,y:N.y+Q}:{x:I,y:Q}},mm=function(P,u){return u>2*P?P:u/2},qo=function(m,A,B,e){var T=p(m,A);return B=e?W(B,T):mm(B,T),T?B/=T:B=0,{x:m.x+(A.x-m.x)*B,y:m.y+(A.y-m.y)*B}},zd=function(U,e){var B,Z,n=U.gv,c=U._data,b=c._40I,h=c._41I,C=c.s("edge.offset"),P=c.s("edge.source.position"),V=c.s("edge.target.position"),W=c.s("edge.source.offset.x"),F=c.s("edge.source.offset.y"),Y=c.s("edge.target.offset.x"),f=c.s("edge.target.offset.y"),G=c.s("edge.source.anchor.x"),w=c.s("edge.source.anchor.y"),S=c.s("edge.target.anchor.x"),z=c.s("edge.target.anchor.y");if(e?(B=y.getEdgeAgentPosition(n,b,P,W,F,G,w),Z=y.getEdgeAgentPosition(n,h,V,Y,f,S,z)):(B=y.getEdgeAgentPosition(n,b,P,0,0,G,w),Z=y.getEdgeAgentPosition(n,h,V,0,0,S,z)),"points"===c.s("edge.type")&&C&&!c.s("edge.center")&&B){var u=c.s("edge.points")||new d,s=u.size(),t=qo(B,s?u.get(0):Z,C,s),_=qo(Z,s?u.get(s-1):B,C,s);B=t,Z=_}return[B,Z]},Yf=function(l,n,r){var $=l._78o,h=l._data,t=h.s("edge.type"),b=[$.sourcePoint,$.targetPoint];return"points"===t?r&&(b=zd(l)):b=$.center?t?r?zd(l):zd(l,!0):r?zd(l):[$.c1,$.c2]:r?zd(l):zd(l,!0),n=new d(n?n._as:_),n.add(b[0],0),n.add(b[1]),n},Hq=function(c){return c=new d(c._as),c.removeAt(0),c.removeAt(c.size()-1),c},bg=function(_){_._as||(_=new d(_));var Y=new d;Y.add(1);for(var B=1;B<_.size();B++)Y.add(2);return Y},ar=function(J,n){return{x:(J.x+n.x)/2,y:(J.y+n.y)/2}},Mr=function(t,C){return{x:t.x+1*(C.x-t.x)/4,y:t.y+1*(C.y-t.y)/4}},zn=function(z,c){return{x:z.x+3*(c.x-z.x)/4,y:z.y+3*(c.y-z.y)/4}},Bs=function(p,n,m,o){var f=n.x+n.width/2,T=n.y+n.height/2,L=A(f*f+T*T),e=K(T,f)+m;return{x:o.x+L*h(e),y:o.y+L*M(e)}},hq=J.validateImpl,zl=J.isRectEditable,Qh=J.isPointEditable,lj=J._42,Ob=T._79o,Qe=N._79o,tj=T._48O,rl=T._47O,ms=E._48O,tl=E._80o,hi=T._80o,Oj=E.getSelectWidth,Fd=E._47O,cf=N._47O,qh=J.isEditable,kj=["northwest","north","northeast","east","southeast","south","southwest","west"],Gg=function(d,g,i,D,l,T,J,I,x,M){var B=d.x,N=d.y,z=d.width,k=d.height,r={x:B+z/2,y:N+k/2};D=D||0,g=Lj(r,g.x-r.x,g.y-r.y,-D),J&&!I&&(g.x+=x,g.y+=M);var p=.01;if("northwest"===i?(g.x+l>B+z-p&&(g.x=B+z-l-p),g.y+l>N+k-p&&(g.y=N+k-l-p),d=b(g,{x:B+z,y:N+k})):"north"===i?(g.y+l>N+k-p&&(g.y=N+k-l-p),d=b({x:B,y:g.y},{x:B+z,y:N+k})):"northeast"===i?(g.x<B+l+p&&(g.x=B+l+p),g.y+l>N+k-p&&(g.y=N+k-l-p),d=b({x:B,y:g.y},{x:g.x,y:N+k})):"west"===i?(g.x+l>B+z-p&&(g.x=B+z-l-p),d=b({x:g.x,y:N},{x:B+z,y:N+k})):"east"===i?(g.x<B+l+p&&(g.x=B+l+p),d=b({x:B,y:N},{x:g.x,y:N+k})):"southwest"===i?(g.x+l>B+z-p&&(g.x=B+z-l-p),g.y<N+l+p&&(g.y=N+l+p),d=b({x:g.x,y:N},{x:B+z,y:g.y})):"south"===i?(g.y<N+l+p&&(g.y=N+l+p),d=b({x:B,y:N},{x:B+z,y:g.y})):"southeast"===i&&(g.x<B+l+p&&(g.x=B+l+p),g.y<N+l+p&&(g.y=N+l+p),d=b({x:B,y:N},g)),"keepRatio"===T&&(!J&&I||J&&!I)&&("northeast"===i||"southeast"===i||"northwest"===i||"southwest"===i)){var E=d.width,V=d.height,f=E/z,m=V/k,Z=W(f,m);d.width=z*Z,d.height=k*Z,"northeast"===i?d.y=N+(k-d.height):"northwest"===i?(d.y=N+(k-d.height),d.x=B+(z-d.width)):"southwest"===i&&(d.x=B+(z-d.width))}d.x-=r.x,d.y-=r.y;var u=Bs(_,d,D,r);return d.x=u.x-d.width/2,d.y=u.y-d.height/2,d},tb=function(w,f,j,m){var B=w.getRotation(),l=f,h=l.x,i=l.y,n=l.width,D=l.height,Y={x:h+l.width/2,y:i+l.height/2};m=Lj(Y,m.x-Y.x,m.y-Y.y,-B),"northwest"===j?l=b(m,{x:h+n,y:i+D}):"north"===j?l=b({x:h,y:m.y},{x:h+n,y:i+D}):"northeast"===j?l=b({x:h,y:m.y},{x:m.x,y:i+D}):"west"===j?l=b({x:m.x,y:i},{x:h+n,y:i+D}):"east"===j?l=b({x:h,y:i},{x:m.x,y:i+D}):"southwest"===j?l=b({x:m.x,y:i},{x:h+n,y:m.y}):"south"===j?l=b({x:h,y:i},{x:h+n,y:m.y}):"southeast"===j&&(l=b({x:h,y:i},m)),w.setRect(l),l.x-=Y.x,l.y-=Y.y;var E=Bs(w,l,B,Y);w.p(E.x,E.y)},$l=function(B,o,C,w,a,H,v,P){var R=_;H?(R=Lj(_,a.x-o.x,a.y-o.y,-C),R.x-=v.x,R.y-=v.y):R=Lj(_,a.x-o.x,a.y-o.y,0);var r={x:o.x+R.x,y:o.y+R.y};P&&(r=P(r.x,r.y)),r.e=B.getPoints().get(w).e,B.setPoint(w,r);var X=B.getWidth(),V=B.getHeight(),l=B.p().x-X/2,N=B.p().y-V/2;l-=o.x,N-=o.y;var A=Bs(B,{x:l,y:N,width:X,height:V},C,o);B.p(A.x,A.y)},Ej=function(Z,I,m){var F,x;if(Z instanceof P?(F=Z.getPoints(),x=Z.getSegments()):Z instanceof Y&&"points"===Z.s("edge.type")&&(F=Z.s("edge.points"),x=Z.s("edge.segments"),F=Yf(I,F)),x&&x.size()||(x=bg(F)),Z instanceof P&&Z.isClosePath()&&x.indexOf(5)<0&&(x=new d(x._as),x.add(5)),x)for(var X=-1,q=0;q<x.size();q++){if(q===m)return X;var V=x.get(q);1===V?X+=1:2===V?X+=1:3===V?X+=2:4===V&&(X+=3)}},Cf=function(w,X,S){var B,e;if(w instanceof P?(B=w.getPoints(),e=w.getSegments()):w instanceof Y&&"points"===w.s("edge.type")&&(B=w.s("edge.points"),e=w.s("edge.segments"),B=Yf(X,B)),e&&e.size()||(e=bg(B)),e)for(var W=-1,x=0;x<e.size();x++){var R=e.get(x);if(1===R?W+=1:2===R?W+=1:3===R?W+=2:4===R&&(W+=3),W===S)return x}},Ln=function(G,U){var v=[G[0]-U[0],G[1]-U[1],G[2]-U[2]];return v},Og=function(){var Z=new Q(16);return Z[0]=1,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=1,Z[6]=0,Z[7]=0,Z[8]=0,Z[9]=0,Z[10]=1,Z[11]=0,Z[12]=0,Z[13]=0,Z[14]=0,Z[15]=1,Z},ef=function(A,b){var H=A[0],Z=A[1],F=A[2];return A[0]=b[0]*H+b[4]*Z+b[8]*F+b[12],A[1]=b[1]*H+b[5]*Z+b[9]*F+b[13],A[2]=b[2]*H+b[6]*Z+b[10]*F+b[14],A},Vc=function(A,k){if(k){var V=M(k),B=h(k),$=A[0],Y=A[1],Q=A[2],T=A[3],J=A[8],y=A[9],o=A[10],s=A[11];A[0]=$*B-J*V,A[1]=Y*B-y*V,A[2]=Q*B-o*V,A[3]=T*B-s*V,A[8]=$*V+J*B,A[9]=Y*V+y*B,A[10]=Q*V+o*B,A[11]=T*V+s*B}},Rc=function(a,e){for(var d=a.s("grid.row.count"),c=a.s("grid.column.count"),h=0;d>h;h++)for(var O=0;c>O;O++){var r=a.getCellRect(h,O);if(I(r,e))return{rowIndex:h,columnIndex:O,rect:r,grid:a}}return null},Sl=function(h,m,f,b,I,Z){var p={},B=f-h,d=b-m,A=z.sqrt(B*B+d*d),G=B/A,u=d/A,E=(-h+I)*G+(-m+Z)*u;return 0>=E?(p.x=h,p.y=m):E>=A?(p.x=f,p.y=b):(p.x=h+E*G,p.y=m+E*u),B=I-p.x,d=Z-p.y,p.z=z.sqrt(B*B+d*d),p},Wj=function(Z,X){var $,Q,v,q,V,P,l,F,N=Z.getPoints(),L=Z.getSegments(),T=Z.p(),J=Z.getRotation();if(!L||!(L.indexOf(3)>0||L.indexOf(4)>0)){for(F=0;F<=N.size()-1;F++)if(F===N.size()-1?(V=N.get(0),q=N.get(F)):(q=N.get(F),V=N.get(F+1)),q=Lj(T,q.x-T.x,q.y-T.y,J),V=Lj(T,V.x-T.x,V.y-T.y,J),P=Sl(q.x,q.y,V.x,V.y,X.x,X.y),l=P.z,l<(Z.s("shape.border.width")||10)){Q=q,v=V,$=F;break}if($!=_){var G=Sl(Q.x,Q.y,v.x,v.y,X.x,X.y),j=p(Q,G);return{attachIndex:$,attachOffset:j}}}},To=function(g){for(var p=g._data,O=p.p(),A=p.getRotation(),Z=p.getPoints(),m=_,V=[],w=0;w<Z.size();w++)m=Z.get(w),V.push(Lj(O,m.x-O.x,m.y-O.y,A));g._55O.$15l=V};J._editPointSize=a?24:9,J._edgeHelpers=["parent","remove","source","target"],J._leftTopHelpers=["parent"],J._rightTopHelpers=["host"],J._leftBottomHelpers=["edge"],J._rightBottomHelpers=["remove"],kj=kj.concat(kj).concat(kj),N._79o=function(){var D=this,P=D.gv,c=P.getZoom(),R=P._editInteractor,W=Qe.call(D);if(!W)return null;var q=zd(D,!0),Y=q[0],d=q[1],C={x:W.x,y:W.y,width:W.width,height:W.height},B=b(Y,d);if(R instanceof k.XEditInteractor){C=U(C,B);var Q=D._55O,g=P.getEditPointSize()/c+2,w=0;Q&&Q._43O&&(w+=g/2,n(C,w))}return C},N._47O=function(e){var z=this,Y=z.gv,_=Y._editInteractor;_ instanceof k.XEditInteractor||cf.call(z,e)},N.rectIntersects=function(i){var p=this,K=p._data,Q=p.gv,X=Q.getZoom(),N=p._55O,u=Q._editInteractor;if(u instanceof k.XEditInteractor&&Q.isEditable(K)&&N&&N._43O&&"points"===K.s("edge.type")){var W=K.s("edge.points"),s=K.s("edge.segments");W=Yf(p,W),s&&s.size()||(s=bg(W)),W=W._as;var $=!1,y=a?5:1,h=i.x+y,j=i.y+y,G={x:h,y:j};if(u._edge===K&&u._hoverSegmentIndex>=0){var T=Q._editInteractor._hoverSegmentIndex,e=s.get(T),A=Ej(K,p,T),w=_;if(A!=_&&A>=0){var b=W[A],D=Q.getSegmentHoverWidth()/X;if(2===e||1===e){var L=W[A+1];w=qf(new ym(b.x,b.y),new ym(L.x,L.y),new ym(G.x-D,G.y-D),new ym(G.x+2*D,G.y+2*D)),w.$62l===g&&($=!0)}else if(3===e){var V=W[A+1],L=W[A+2];w=Xh(new ym(b.x,b.y),new ym(V.x,V.y),new ym(L.x,L.y),new ym(G.x-D,G.y-D),new ym(G.x+2*D,G.y+2*D)),w.$62l===g&&($=!0)}else if(4===e){var l=W[A+1],z=W[A+2];L=W[A+3],w=Mi(new ym(b.x,b.y),new ym(l.x,l.y),new ym(z.x,z.y),new ym(L.x,L.y),new ym(G.x-D,G.y-D),new ym(G.x+2*D,G.y+2*D)),w.$62l===g&&($=!0)}}}if($)return!0}return _},T._47O=function(N){var u=this,s=u.gv,X=s._editInteractor;X instanceof k.XEditInteractor||rl.call(u,N)},T.rectIntersects=function(r){var z=this,V=z._data,K=z.gv,v=K.getZoom(),B=z._55O,i=K._editInteractor;if(i instanceof k.XEditInteractor&&K.isEditable(V)&&B&&B._43O){var T=B.$15l,c=!1,u=a?5:1,J=r.x+u,n=r.y+u,C={x:J,y:n};if(T&&T.length===V.getPoints().size()||(To(z),T=B.$15l),i._shape===V&&i._hoverSegmentIndex>=0){var I=V.getSegments();I&&I.size()||(I=bg(T));var m=K._editInteractor._hoverSegmentIndex,A=I.get(m),d=Ej(V,z,m),R=_;if(d!=_&&d>=0){var y=T[d],Q=K.getSegmentHoverWidth()/v;if(2===A||1===A){var t=T[d+1];R=qf(new ym(y.x,y.y),new ym(t.x,t.y),new ym(C.x-Q,C.y-Q),new ym(C.x+2*Q,C.y+2*Q)),R.$62l===g&&(c=!0)}else if(3===A){var Y=T[d+1],t=T[d+2];R=Xh(new ym(y.x,y.y),new ym(Y.x,Y.y),new ym(t.x,t.y),new ym(C.x-Q,C.y-Q),new ym(C.x+2*Q,C.y+2*Q)),R.$62l===g&&(c=!0)}else if(4===A){var N=T[d+1],h=T[d+2];t=T[d+3],R=Mi(new ym(y.x,y.y),new ym(N.x,N.y),new ym(h.x,h.y),new ym(t.x,t.y),new ym(C.x-Q,C.y-Q),new ym(C.x+2*Q,C.y+2*Q)),R.$62l===g&&(c=!0)}}}if(c)return!0}return _},T._48O=function(){var r=this,g=r.gv,D=g._editInteractor;D instanceof k.XEditInteractor?(E._48O.call(r),r._55O._43O&&To(r)):tj.call(r)},T._79o=function(){var F=this,z=F.gv,o=z.getZoom(),i=z._editInteractor,N=Ob.call(F);if(N){var e={x:N.x,y:N.y,width:N.width,height:N.height};if(i instanceof k.XEditInteractor){var Y=F._55O,r=z.getEditPointSize()/o+2,C=0;Y&&Y._43O&&(C+=r/2,n(e,C))}return e}},E._47O=function(m){var x=this,V=x.gv,F=V._editInteractor;if(F instanceof k.XEditInteractor);else{var n=x._55O;n&&n._98o&&Fd.call(x,m)}},E.getSelectWidth=function(){var d=this,J=d.gv,H=J._editInteractor,R=d._data;return J.isEditable(R)&&H instanceof k.XEditInteractor?0:Oj.call(d)},E._80o=function(A){var v=this,N=v.gv._editInteractor;if(tl.call(v,A),N&&N._debug){A.save(),A.beginPath(),A.lineWidth=1,A.strokeStyle="green";var U=v._79o();U&&(A.rect(U.x,U.y,U.width,U.height),A.stroke()),A.restore()}},T._80o=function(f){var u=this,X=u.gv._editInteractor;if(hi.call(u,f),X&&X._debug){f.save(),f.beginPath(),f.lineWidth=1,f.strokeStyle="green";var B=u._79o();f.rect(B.x,B.y,B.width,B.height),f.stroke(),f.restore()}},E._48O=function(){var y=this,r=y.gv,l=y._data,x=r._editInteractor,M=y._55O,Y=l.p(),A=l.getRotation();if(x instanceof k.XEditInteractor){if(M._42O){var Z=Eq(Y,l.getWidth(),l.getHeight(),A),T=Z[0],p=Z[1],_=Z[2],e=Z[3],X=Z[4],N=Z[5],D=Z[6],g=Z[7];M.$45l=[T,X,p,N,e,D,_,g]}}else ms.call(y)},J.getResizeMode=function(){return this.$25l||"normal"},J.setResizeMode=function(d){var Z=this.$25l;this.$25l=d,this.fp("resizeMode",Z,d)},J.getSnapAngle=function(){return this.$26l||Math.PI/36},J.setSnapAngle=function(b){var w=this.$26l;this.$26l=b,this.fp("snapAngle",w,b)},J.getSnapSpacing=function(){return this.$27l},J.setSnapSpacing=function(Y){var h=this.$27l;this.$27l=Y,this.fp("snapSpacing",h,Y)},J.getPointSnapSpacing=function(){return this._pointSnapSpacing},J.setPointSnapSpacing=function(Q){var w=this._pointSnapSpacing;this._pointSnapSpacing=Q,this.fp("pointSnapSpacing",w,Q)},J.setHelperEditableFunc=function(z){var e=this._helperEditableFunc;this._helperEditableFunc=z,this.fp("helperEditableFunc",e,z)},J.getHelperEditableFunc=function(){return this._helperEditableFunc},J.setLeftTopHelpers=function(s){var Q=this._leftTopHelpers;this._leftTopHelpers=s,this.fp("leftTopHelpers",Q,s)},J.getLeftTopHelpers=function(){return this._leftTopHelpers},J.setLeftTopHelpersAlign=function(E){var k=this._leftTopHelpersAlign;this._leftTopHelpersAlign=E,this.fp("leftTopHelpersAlign",k,E)},J.getLeftTopHelpersAlign=function(){return this._leftTopHelpersAlign},J.setRightTopHelpers=function(x){var w=this._rightTopHelpers;this._rightTopHelpers=x,this.fp("rightTopHelpers",w,x)},J.getRightTopHelpers=function(){return this._rightTopHelpers},J.setRightTopHelpersAlign=function(J){var j=this._rightTopHelpersAlign;this._rightTopHelpersAlign=J,this.fp("rightTopHelpersAlign",j,J)},J.getRightTopHelpersAlign=function(){return this._rightTopHelpersAlign},J.setLeftBottomHelpers=function(Y){var t=this._leftBottomHelpers;this._leftBottomHelpers=Y,this.fp("leftBottomHelpers",t,Y)},J.getLeftBottomHelpers=function(){return this._leftBottomHelpers},J.setLeftBottomHelpersAlign=function(k){var L=this._leftBottomHelpersAlign;this._leftBottomHelpersAlign=k,this.fp("leftBottomHelpersAlign",L,k)},J.getLeftBottomHelpersAlign=function(){return this._leftBottomHelpersAlign},J.setRightBottomHelpers=function(P){var G=this._rightBottomHelpers;this._rightBottomHelpers=P,this.fp("rightBottomHelpers",G,P)},J.getRightBottomHelpers=function(){return this._rightBottomHelpers},J.setRightBottomHelpersAlign=function(d){var P=this._rightBottomHelpersAlign;this._rightBottomHelpersAlign=d,this.fp("rightBottomHelpersAlign",P,d)},J.getRightBottomHelpersAlign=function(){return this._rightBottomHelpersAlign},J.setEdgeHelpers=function(H){var a=this._edgeHelpers;this._edgeHelpers=H,this.fp("edgeHelpers",a,H)},J.getEdgeHelpers=function(){return this._edgeHelpers},J.isHelperEditable=function(T,z){return T instanceof Y&&("host"===z||"edge"===z||"elevation"===z||"tall"===z)?!1:T instanceof G&&("source"===z||"target"===z)?!1:"pointElevation"===z?this._helperEditableFunc?this._helperEditableFunc(T,z):!1:this._helperEditableFunc?this._helperEditableFunc(T,z):!0},J.getEditHelperSize=function(){return this._editHelperSize||(a?28:16)},J.setEditHelperSize=function(l){var e=this._editHelperSize;this._editHelperSize=l,this.fp("editHelperSize",e,l)},J.getEditRectBorderColor=function(){return this.$28l||"rgb(0, 168, 255)"},J.setEditRectBorderColor=function(R){var A=this.$28l;this.$28l=R,this.fp("editRectBorderColor",A,R)},J.getNodeBorderColor=function(){return this.$29l||"#1ABC9C"},J.setNodeBorderColor=function(a){var x=this.$29l;this.$29l=a,this.fp("nodeBorderColor",x,a)},J.getEditRectBorderStyle=function(){return this.$30l||"dashed"},J.setEditRectBorderStyle=function(O){var x=this.$30l;this.$30l=O,this.fp("editRectBorderStyle",x,O)},J.getControlPointBackground=function(){return this.$31l||"#ff0"},J.setControlPointBackground=function(d){var P=this.$31l;this.$31l=d,this.fp("controlPointBackground",P,d)},J.getControlPointBorderColor=function(){return this.$32l||this._editPointBorderColor},J.setControlPointBorderColor=function(V){var t=this.$32l;this.$32l=V,this.fp("controlPointBorderColor",t,V)},J.getJoinPointBackground=function(){return this.$33l||this._editPointBackground},J.setJoinPointBackground=function(P){var Z=this.$33l;this.$33l=P,this.fp("joinPointBackground",Z,P)},J.getJoinPointBorderColor=function(){return this.$34l||this._editPointBorderColor},J.setJoinPointBorderColor=function(o){var r=this.$34l;this.$34l=o,this.fp("joinPointBorderColor",r,o)},J.getDirectionLineColor=function(){return this.$35l||"#888"},J.setDirectionLineColor=function(l){var E=this.$35l;this.$35l=l,this.fp("directionLineColor",E,l)},J.getSegmentHoverColor=function(){return this.$36l||"rgba(255, 0, 0, 0.3)"},J.setSegmentHoverColor=function(A){var q=this.$36l;this.$36l=A,this.fp("segmentHoverColor",q,A)},J.getSegmentHoverWidth=function(){return this.$22l||(a?16:8)},J.setSegmentHoverWidth=function(s){var r=this.$22l;this.$22l=s,this.fp("segmentHoverWidth",r,s)},J.getSnapPointBorderColor=function(){return this.$38l||"#f00"},J.setSnapPointBorderColor=function(N){var x=this.$38l;this.$38l=N,this.fp("snapPointBorderColor",x,N)},J.getEditRectPadding=function(){return this.$39l!=_?this.$39l:6},J.setEditRectPadding=function(R){var l=this.$39l;this.$39l=R,this.fp("editRectPading",l,R)},J.isRectEditable=function(R){var O=this,f=O._editInteractor;return f instanceof k.XEditInteractor?O._rectEditableFunc?O._rectEditableFunc(R):!0:zl.call(O,R)},J.isPointEditable=function(H){var L=this,i=L._editInteractor;return i instanceof k.XEditInteractor?L._pointEditableFunc?L._pointEditableFunc(H):!0:Qh.call(L,H)},J.validateImpl=function(){var r=this,Z=r.$14l,Y=r._editInteractor;if(Z){var W=r.getWidth(),d=r.getHeight();(W!==Z.clientWidth||d!==Z.clientHeight)&&(Y&&(Y._68I=1),y.setCanvas(Z,W,d),r._32I=1)}hq.call(this)},J.isEditable=function(r){var h=qh.call(this,r),E=this._editInteractor;if(E instanceof k.XEditInteractor&&r instanceof Y){if(!r.s("2d.editable"))return!1;var F=this.getEditableFunc();h=F?F(r):!0}return h},J._42=function(a,J){var e=this,Q=e._editInteractor;lj.call(e,a,J),Q instanceof k.XEditInteractor&&Q._68I&&Q._42()},J.isSnapPoint=function(){return!0};var ll=function(f){arguments.length>0&&this.$58l(f)},cl=ll.prototype;cl.$58l=function(u){this.$62l=u,this.points=new Array},cl.$56l=function(g){this.points.push(g)},cl.$57l=function($){this.points=this.points.concat($)};var ym=function(g,h){arguments.length>0&&this.$58l(g,h)},Ff=ym.prototype;Ff.$58l=function(Q,G){this.x=Q,this.y=G},Ff.add=function(Y){return new ym(this.x+Y.x,this.y+Y.y)},Ff.addEquals=function(t){return this.x+=t.x,this.y+=t.y,this},Ff.$55l=function(w){return new ym(this.x*w,this.y*w)},Ff.eq=function(A){return this.x==A.x&&this.y==A.y},Ff.lt=function(g){return this.x<g.x&&this.y<g.y},Ff.lte=function(T){return this.x<=T.x&&this.y<=T.y},Ff.gt=function(O){return this.x>O.x&&this.y>O.y},Ff.gte=function(t){return this.x>=t.x&&this.y>=t.y},Ff.lerp=function(c,v){return new ym(this.x+(c.x-this.x)*v,this.y+(c.y-this.y)*v)},Ff.distanceFrom=function(T){var n=this.x-T.x,p=this.y-T.y;return A(n*n+p*p)},Ff.min=function(H){return new ym(W(this.x,H.x),W(this.y,H.y))},Ff.max=function(t){return new ym(F(this.x,t.x),F(this.y,t.y))},Ff.toString=function(){return this.x+","+this.y};var ap=function(){this.$58l(arguments)},pp=ap.prototype;ap.TO=1e-6,ap.AC=6,pp.$58l=function(h){this.co=new Array;for(var B=h.length-1;B>=0;B--)this.co.push(h[B])},pp.$55l=function(Y){for(var h=new ap,Z=0;Z<=this.$50l()+Y.$50l();Z++)h.co.push(0);for(var Z=0;Z<=this.$50l();Z++)for(var d=0;d<=Y.$50l();d++)h.co[Z+d]+=this.co[Z]*Y.co[d];return h},pp.$59l=function(){for(var Y=this.$50l();Y>=0&&R(this.co[Y])<=ap.TO;Y--)this.co.pop()},pp.$50l=function(){return this.co.length-1},pp.$51l=function(){var W;switch(this.$59l(),this.$50l()){case 0:W=new Array;break;case 1:W=this.$52l();break;case 2:W=this.$53l();break;case 3:W=this.$54l();break;case 4:W=this.$63l();break;default:W=new Array}return W},pp.$52l=function(){var w=new Array,N=this.co[1];return 0!=N&&w.push(-this.co[0]/N),w},pp.$53l=function(){var z=new Array;if(2==this.$50l()){var n=this.co[2],T=this.co[1]/n,_=this.co[0]/n,s=T*T-4*_;if(s>0){var Q=A(s);z.push(.5*(-T+Q)),z.push(.5*(-T-Q))}else 0==s&&z.push(.5*-T)}return z},pp.$63l=function(){var C=new Array;if(4==this.$50l()){var m=this.co[4],z=this.co[3]/m,n=this.co[2]/m,g=this.co[1]/m,Q=this.co[0]/m,d=new ap(1,-n,z*g-4*Q,-z*z*Q+4*n*Q-g*g).$54l(),W=d[0],T=z*z/4-n+W;if(R(T)<=ap.TO&&(T=0),T>0){var c=A(T),b=3*z*z/4-c*c-2*n,B=(4*z*n-8*g-z*z*z)/(4*c),l=b+B,H=b-B;if(R(l)<=ap.TO&&(l=0),R(H)<=ap.TO&&(H=0),l>=0){var G=A(l);C.push(-z/4+(c+G)/2),C.push(-z/4+(c-G)/2)}if(H>=0){var G=A(H);C.push(-z/4+(G-c)/2),C.push(-z/4-(G+c)/2)}}else if(0>T);else{var B=W*W-4*Q;if(B>=-ap.TO){if(0>B&&(B=0),B=2*A(B),b=3*z*z/4-2*n,b+B>=ap.TO){var s=A(b+B);C.push(-z/4+s/2),C.push(-z/4-s/2)}if(b-B>=ap.TO){var s=A(b-B);C.push(-z/4+s/2),C.push(-z/4-s/2)}}}}return C},pp.$54l=function(){var q=new Array;if(3==this.$50l()){var O=this.co[3],Q=this.co[2]/O,J=this.co[1]/O,t=this.co[0]/O,I=(3*J-Q*Q)/3,Y=(2*Q*Q*Q-9*J*Q+27*t)/27,p=Q/3,v=Y*Y/4+I*I*I/27,X=Y/2;if(R(v)<=ap.TO&&(v=0),v>0){var G,C,H=A(v);G=-X+H,C=G>=0?S(G,1/3):-S(-G,1/3),G=-X-H,G>=0?C+=S(G,1/3):C-=S(-G,1/3),q.push(C-p)}else if(0>v){var f=A(-I/3),g=K(A(-v),-X)/3,e=h(g),b=M(g),u=A(3);q.push(2*f*e-p),q.push(-f*(e+u*b)-p),q.push(-f*(e-u*b)-p)}else{var G;G=X>=0?-S(X,1/3):S(-X,1/3),q.push(2*G-p),q.push(-G-p)}}return q};var En=function(k,N){arguments.length>0&&this.$58l(k,N)},wm=En.prototype;wm.$58l=function(q,$){this.x=q,this.y=$},wm.length=function(){return A(this.x*this.x+this.y*this.y)},wm.$60l=function(j){return this.x*j.x+this.y*j.y};var No=function(D,W,a,r){var K,p=(r.x-a.x)*(D.y-a.y)-(r.y-a.y)*(D.x-a.x),V=(W.x-D.x)*(D.y-a.y)-(W.y-D.y)*(D.x-a.x),e=(r.y-a.y)*(W.x-D.x)-(r.x-a.x)*(W.y-D.y);if(0!=e){var m=p/e,Y=V/e;m>=0&&1>=m&&Y>=0&&1>=Y?(K=new ll(g),K.points.push(new ym(D.x+m*(W.x-D.x),D.y+m*(W.y-D.y)))):K=new ll(s)}else K=0==p||0==V?new ll("C"):new ll("P");return K},gq=function(b,X,Q,R,W){var q,r,x,j,I,U,p,K=R.min(W),G=R.max(W),V=new ll(s);q=X.$55l(-2),x=b.add(q.add(Q)),q=b.$55l(-2),r=X.$55l(2),j=q.add(r),I=new ym(b.x,b.y),p=new En(R.y-W.y,W.x-R.x),U=R.x*W.y-W.x*R.y;for(var O=new ap(p.$60l(x),p.$60l(j),p.$60l(I)+U).$51l(),Z=0;Z<O.length;Z++){var $=O[Z];if($>=0&&1>=$){var Y=b.lerp(X,$),h=X.lerp(Q,$),A=Y.lerp(h,$);R.x==W.x?K.y<=A.y&&A.y<=G.y&&(V.$62l=g,V.$56l(A)):R.y==W.y?K.x<=A.x&&A.x<=G.x&&(V.$62l=g,V.$56l(A)):A.gte(K)&&A.lte(G)&&(V.$62l=g,V.$56l(A))}}return V},Xh=function(Z,j,v,U,c){var e=U.min(c),H=U.max(c),r=new ym(H.x,e.y),W=new ym(e.x,H.y),m=gq(Z,j,v,e,r),$=gq(Z,j,v,r,H),t=gq(Z,j,v,H,W),E=gq(Z,j,v,W,e),J=new ll(s);return J.$57l(m.points),J.$57l($.points),J.$57l(t.points),J.$57l(E.points),J.points.length>0&&(J.$62l=g),J},yo=function(Y,j,S,i,W,M){var z,f,O,F,P,t,w,u,x,K,E=W.min(M),_=W.max(M),V=new ll(s);z=Y.$55l(-1),f=j.$55l(3),O=S.$55l(-3),F=z.add(f.add(O.add(i))),P=new En(F.x,F.y),z=Y.$55l(3),f=j.$55l(-6),O=S.$55l(3),F=z.add(f.add(O)),t=new En(F.x,F.y),z=Y.$55l(-3),f=j.$55l(3),O=z.add(f),w=new En(O.x,O.y),u=new En(Y.x,Y.y),K=new En(W.y-M.y,M.x-W.x),x=W.x*M.y-M.x*W.y;for(var k=new ap(K.$60l(P),K.$60l(t),K.$60l(w),K.$60l(u)+x).$51l(),d=0;d<k.length;d++){var y=k[d];if(y>=0&&1>=y){var b=Y.lerp(j,y),Q=j.lerp(S,y),n=S.lerp(i,y),H=b.lerp(Q,y),$=Q.lerp(n,y),X=H.lerp($,y);W.x==M.x?E.y<=X.y&&X.y<=_.y&&(V.$62l=g,V.$56l(X)):W.y==M.y?E.x<=X.x&&X.x<=_.x&&(V.$62l=g,V.$56l(X)):X.gte(E)&&X.lte(_)&&(V.$62l=g,V.$56l(X))}}return V},Mi=function(_,m,x,o,I,F){var E=I.min(F),y=I.max(F),t=new ym(y.x,E.y),X=new ym(E.x,y.y),Y=yo(_,m,x,o,E,t),W=yo(_,m,x,o,t,y),z=yo(_,m,x,o,y,X),n=yo(_,m,x,o,X,E),e=new ll(s);return e.$57l(Y.points),e.$57l(W.points),e.$57l(z.points),e.$57l(n.points),e.points.length>0&&(e.$62l=g),e},qf=function(H,m,I,K){var G=I.min(K),N=I.max(K),Y=new ym(N.x,G.y),q=new ym(G.x,N.y),B=No(G,Y,H,m),l=No(Y,N,H,m),O=No(N,q,H,m),J=No(q,G,H,m),Q=new ll(s);return Q.$57l(B.points),Q.$57l(l.points),Q.$57l(O.points),Q.$57l(J.points),Q.points.length>0&&(Q.$62l=g),Q},rn=k.XEditInteractor=function(c){var $=this,d=$._view=document.createElement("canvas");d.className="editCanvas",d.style.position="absolute",rn.superClass.constructor.call($,c)};r.def(rn,k.Interactor,{ms_edit:1,setUp:function(){var i=this,I=i.gv,Q=I.getView(),z=i._view;rn.superClass.setUp.call(i),I.setEditInteractor(i),I.$14l=z,I._79O?Q.insertBefore(z,I._79O):Q.appendChild(z);var T=i.$49l=i.$11l.bind(i);I.dm().md(T),I.sm().ms(T),I.mp(T)},tearDown:function(){var L=this,A=L.gv,x=A.getView(),O=L.$49l;rn.superClass.tearDown.call(L),A.setEditInteractor(_),A.$14l=_,x.removeChild(L._view),A.dm().umd(O),A.sm().ums(O),A.ump(O)},clear:function(){var K=this,d=K.gv;delete K._hoverSegmentIndex,delete K._edge,delete K._shape,delete d._editing,delete K.$10l,delete K.$13l,delete K.$9l,delete K._removePointIndex,delete K._lp,K.$12l="",delete K.$40l,delete K.$67l,delete K.$72l,delete K.$73l,delete K.$75l,delete K.$1l,delete K.$3l,delete K.$2l,delete K.$92l,delete K.$93l,delete K.$94l,K.clearDragging()},handle_keydown:function(B){this.$48l!==B.shiftKey&&(this.$48l=B.shiftKey,this.handle_mousemove(B,H,!0))},handle_keyup:function(O){this.$48l!==O.shiftKey&&(this.$48l=O.shiftKey,this.handle_mousemove(O,H,!0))},handle_touchstart:function(t){this.handle_mousemove(t),this.handle_mousedown(t)},handle_mousedown:function(R){f(R);var d=this,q=d.$13l,a=d.gv,U=a.dm(),Z=U.getHistoryManager(),C=a.sm(),E=a.getZoom(),F=a.lp(R),$=r.isDoubleClick(R),k=r.isLeftButton(R),b=d.$7l,B=d._shape,y=d._hoverSegmentIndex,p=d._edge,j=d.$87l,N=d.$88l,_=function(){d._68I||j===d.$87l&&N===d.$88l||d.$43l()};if(7!==d.$67l&&(delete d.$87l,delete d.$88l),k&&(B||p)&&y>=0&&$&&(B&&C.contains(B)||p&&C.contains(p))){var g=xd.call(d,B||p,y,F);return d.addShapePoint(B||p,y,g),w(function(){d.handle_mousemove(R)},40),void 0}if(k&&(B||p)&&d._removePointIndex>=0&&$)return d.removeShapePoint(),d.$5l=1,w(function(){d.handle_mousemove(R)},40),void 0;if(!k||!a._editing)return _(),void 0;if(B&&q>=0){var S=B.getPoints().get(q),z=B.p(),c=Lj(z,S.x-z.x,S.y-z.y,-b+B.getRotation());L=Lj(z,F.x-z.x,F.y-z.y,-b),d.$24l={x:L.x-c.x,y:L.y-c.y},d.startDragging(R),Z&&Z.beginInteraction(),d.fi({kind:"beginEditPoint",event:R,data:B,index:q}),d.$88l=q,d.$87l=B}else if(d.$10l){var h=a.sm().getSelection(),n=d.$6l,M=d.$1l={},e=d.$3l={},m=d.$16l[D[d.$10l]],I={x:n.x,y:n.y},x={x:n.x+n.width/2,y:n.y+n.height/2};d.$24l={x:F.x-m.x/E,y:F.y-m.y/E},d.$2l=t(d.$8l),d.$4l=t(n),h.each(function(K){if(K instanceof G){var u=K.p(),v=K.getWidth(),Q=K.getHeight(),O=Lj(x,u.x-x.x,u.y-x.y,-b);M[K.getId()]={x:u.x-v/2,y:u.y-Q/2,width:v,height:Q},e[K.getId()]={x:(O.x-I.x)/n.width,y:(O.y-I.y)/n.height}}}),d.startDragging(R),Z&&Z.beginInteraction(),d.fi({kind:"beginEditRect",event:R,direction:d.$10l})}else if(p&&q>=0){var s=Yf(a.getDataUI(p),p.s("edge.points")),S=s.get(q);d.$24l={x:F.x-S.x,y:F.y-S.y},d.startDragging(R),Z&&Z.beginInteraction(),d.fi({kind:"beginEditPoint",event:R,data:p,index:q}),d.$88l=q,d.$87l=p}else if(d.$40l){var n=d.$6l,x={x:n.x+n.width/2,y:n.y+n.height/2},Q=t(d.$23l);Q.x/=E,Q.y/=E;var J=Lj(x,Q.x-x.x,Q.y-x.y,-b),L=Lj(x,F.x-x.x,F.y-x.y,-b);d.$24l={x:L.x-J.x,y:L.y-J.y},d.startDragging(R),Z&&Z.beginInteraction(),d.fi({kind:"beginEditRotation",event:R,data:d._rotationNode})}else if([1,2,3,5,6,7,8,9].indexOf(d.$67l)>=0)d.startDragging(R);else if(d.$71l&&$&&d.$79l(d.$71l,F)){var V=C.toSelection();Z&&Z.beginInteraction(),V.each(function(r){U.remove(r)}),Z&&Z.endInteraction()}_()},$11l:function(){var R=this,q=R.gv;q._editing&&(R.$13l==_||R._shape==_&&R._edge==_)&&(R.$73l==_||1!==R.$67l&&5!==R.$67l&&6!==R.$67l)||(R.$5l=1),R._68I=1},$46l:function(Q){var T=this,B=T.gv,O=B.lp(Q),o=[];return bi(B,function(X){var w=B.getDataUI(X);if(w){var h=w._79o();I(h,O)&&o.push(X)}}),o},$47l:function(H){var w=this,U=w.$13l,L=w.gv.dm(),p=L.getHistoryManager();w.$10l?(w.fi({kind:"endEditRect",event:H,direction:w.$10l}),p&&p.endInteraction()):w._shape&&U>=0?(w.fi({kind:"endEditPoint",event:H,data:w._shape,index:U}),p&&p.endInteraction()):w._edge&&U>=0?(w.fi({kind:"endEditPoint",event:H,data:w._edge,index:U}),p&&p.endInteraction()):w.$23l&&w.$40l&&(w.fi({kind:"endEditRotation",event:H}),p&&p.endInteraction())},handleWindowTouchEnd:function(b){this.handleWindowMouseUp(b)},handleWindowMouseUp:function(W){var w=this,I=w.gv,j=I.dm(),v=j.getHistoryManager(),b=w._shape,i=w._edge,f=w.$13l,R=w.$40l,M=w.$9l,T=w.$10l,y=w.$67l;if((b||i)&&f>=0&&M>=0){var l,E;if(b){var L=b.p(),m=b.getRotation();l=b.getPoints(),E=l.get(M),$l(b,L,m,f,E,!1)}else if(l=Yf(I.getDataUI(i),i.s("edge.points"),!0),E=l.get(M),0===f){var P=l.get(0);i.s("edge.source.offset.x",E.x-P.x),i.s("edge.source.offset.y",E.y-P.y)}else if(f===l.size()-1){var U=l.get(l.size()-1);i.s("edge.target.offset.x",E.x-U.x),i.s("edge.target.offset.y",E.y-U.y)}else"points"===i.s("edge.type")&&(l.set(f,E),i.s("edge.points",Hq(l)))}w.$47l(W);var B=w.$73l;1===y?(v&&v.beginInteraction(),B?I.sm().each(function(o){if(o.setHost&&I.isHelperEditable(o,"host")){o.setHost(B);
var d=w.$75l,Y=w.$74l;d&&(o.s("attach.row.index",d.rowIndex),o.s("attach.column.index",d.columnIndex)),Y&&(o.s("attach.index",Y.attachIndex),o.s("attach.offset",Y.attachOffset),o.s("attach.offset.relative",!1),o.s("attach.offset.opposite",!1))}}):I.sm().each(function(X){X.setHost&&I.isHelperEditable(X,"host")&&(X.setHost(_),X.s("attach.row.index",H),X.s("attach.column.index",H),X.s("attach.index",H),X.s("attach.offset",H),X.s("attach.offset.relative",!1),X.s("attach.offset.opposite",!1))}),v&&v.endInteraction()):2===y?(v&&v.beginInteraction(),B?I.sm().each(function(u){u.setParent&&I.isHelperEditable(u,"parent")&&u.setParent(B)}):I.sm().each(function(J){J.setParent&&I.isHelperEditable(J,"parent")&&J.setParent(_)}),v&&v.endInteraction()):3===y?B&&(v&&v.beginInteraction(),I.sm().each(function(R){if(I.isHelperEditable(R,"edge")&&R instanceof G&&B instanceof G){var t=new u.Edge;j.add(t),t.setSource(R),t.setTarget(B),w.onEdgeCreated&&w.onEdgeCreated(W,t)}}),v&&v.endInteraction()):(5===y||6===y)&&B&&(v&&v.beginInteraction(),I.sm().each(function(A){A instanceof Y&&B instanceof G&&(5===y&&I.isHelperEditable(A,"source")?A.setSource(B):6===y&&I.isHelperEditable(A,"source")&&A.setTarget(B))}),v&&v.endInteraction()),(T||R)&&w.$43l(!0),a?(w.clear(),delete w.$64l,w._68I||w.$43l()):(w.handle_mousemove(W,!0),y&&!w._68I&&w.$43l())},handleWindowTouchMove:function(L){this.handleWindowMouseMove(L)},handleWindowMouseMove:function(t){this._78I(t)},handle_mousemove:function(k,I,Q){if(!this._pause){if(!Q){var v=a?Up(k):k;this.$61l={clientX:v.clientX,clientY:v.clientY}}if(I===!0||!$()){var s=this,c=s.gv,p=!1,D=_;s.clear(),c.sm().size()>0&&(D=c.lp(Q?s.$61l:k),p=s._79I(k,D)),p&&(c._editing=1),s.$12l!==s.$65l&&(s.$65l=s.$12l,s.setCursor(s.$12l)),s.$40l!==s.$64l&&(s.$64l=s.$40l,s._68I||s.$43l()),s._hoverSegmentIndex!==s.$66l&&(s.$66l=s._hoverSegmentIndex,s._68I||s.$43l())}}},_78I:function(f){this.autoScroll(f);var g=this,O=g.gv,q=O.lp(f),J=O.getZoom(),j=g.$13l;if((g._shape||g._edge)&&j>=0){var z,E,u,D=g._shape,b=g._edge,d=g.$24l,m=O.getPointSnapSpacing(),x=function(T,t){return m==_||isNaN(m)?{x:T,y:t}:{x:C(T/m)*m,y:C(t/m)*m}};if(D){z=D.getPoints();var Q=D.p(),S=D.getRotation(),e=0;E=Lj(Q,q.x-Q.x,q.y-Q.y,-S),$l(D,Q,S,j,q,!0,d,x),g.fi({kind:"betweenEditPoint",event:f,data:D,index:j})}else if(b){z=Yf(O.getDataUI(b),b.s("edge.points"),!0),q.x-=d.x,q.y-=d.y,E=q;var L,y,U=b.s("edge.offset"),v=z.size(),V=v>2;if(0===j){var T=z.get(0);U&&(T=qo(T,z.get(1),-U,V),q=qo(q,z.get(1),-U,V)),L=q.x-T.x,y=q.y-T.y,u=x(L,y),b.s("edge.source.offset.x",u.x),b.s("edge.source.offset.y",u.y)}else if(j===v-1){var k=z.get(v-1);U&&(k=qo(k,z.get(v-2),-U,V),q=qo(q,z.get(v-2),-U,V)),L=q.x-k.x,y=q.y-k.y,u=x(L,y),b.s("edge.target.offset.x",u.x),b.s("edge.target.offset.y",u.y)}else"points"===b.s("edge.type")&&(u=x(q.x,q.y),u.e=z.get(j).e,z.set(j,u),b.s("edge.points",Hq(z)));g.fi({kind:"betweenEditPoint",event:f,data:b,index:j})}if(delete g.$9l,O.isSnapPoint(D)||O.isSnapPoint(b))for(e=0;e<z.size();e++)if(e!==j){var t=z.get(e);if(p(t,E)<O.getEditPointSize()/J){g.$9l=e;break}}}else if(g.$10l){var d=g.$24l;q.x-=d.x,q.y-=d.y;var h=O.sm().getSelection(),l=g.$1l,$=g.$7l,F=g.$10l,s=g.$4l,Z=g.$2l,I=O.getEditRectPadding()/J,a=2*I,n=O.getSnapSpacing(),o=n!=_&&!isNaN(n),N=Gg(Z,q,F,$,2*I,O.getResizeMode(),o,!0),X=g.$6l;if(o){var W=N.width-a,H=N.height-a,M=C(W/n)*n,Sl=C(H/n)*n,kq=M-W,Th=Sl-H;("west"===F||"northwest"===F||"southwest"===F)&&(kq=-kq),("north"===F||"northwest"===F||"northeast"===F)&&(Th=-Th),N=Gg(Z,q,F,$,2*I,O.getResizeMode(),o,!1,kq,Th)}g.$8l=N,X.x=N.x+I,X.y=N.y+I,X.width=N.width-a,X.height=N.height-a;var tp=N.x+N.width/2,Eq=N.y+N.height/2,gr=X.x,zo=X.y,xi=X.width/s.width,lq=X.height/s.height;h.each(function(r){if(r instanceof G&&O.isEditable(r)&&O.isRectEditable(r)){var W=l[r.getId()],Y=g.$3l[r.getId()],L={x:W.x+W.width/2,y:W.y+W.height/2},U=0,Q=0,p=F,z=180*R($-r.getRotation())/c;"northeast"===F?z>=315||45>z?(U=W.width*xi+W.x,Q=W.height*(1-lq)+W.y,p="northeast"):z>=45&&135>z?(U=W.width*(1-lq)+W.x,Q=W.height*(1-xi)+W.y,p="northwest"):z>=135&&225>z?(U=W.width*(1-xi)+W.x,Q=W.height*lq+W.y,p="southwest"):(U=W.width*lq+W.x,Q=W.height*xi+W.y,p="southeast"):"north"===F?z>=315||45>z?(Q=W.height*(1-lq)+W.y,p="north"):z>=45&&135>z?(U=W.width*(1-lq)+W.x,p="west"):z>=135&&225>z?(Q=W.height*lq+W.y,p="south"):(U=W.width*lq+W.x,p="east"):"northwest"===F?z>=315||45>z?(U=W.width*(1-xi)+W.x,Q=W.height*(1-lq)+W.y,p="northwest"):z>=45&&135>z?(U=W.width*(1-lq)+W.x,Q=W.height*xi+W.y,p="southwest"):z>=135&&225>z?(U=W.width*xi+W.x,Q=W.height*lq+W.y,p="southeast"):(U=W.width*lq+W.x,Q=W.height*(1-xi)+W.y,p="northeast"):"west"===F?z>=315||45>z?(U=W.width*(1-xi)+W.x,p="west"):z>=45&&135>z?(Q=W.height*xi+W.y,p="south"):z>=135&&225>z?(U=W.width*xi+W.x,p="east"):(Q=W.height*(1-xi)+W.y,p="north"):"southwest"===F?z>=315||45>z?(U=W.width*(1-xi)+W.x,Q=W.height*lq+W.y,p="southwest"):z>=45&&135>z?(U=W.width*lq+W.x,Q=W.height*xi+W.y,p="southeast"):z>=135&&225>z?(U=W.width*xi+W.x,Q=W.height*(1-lq)+W.y,p="northeast"):(U=W.width*(1-lq)+W.x,Q=W.height*(1-xi)+W.y,p="northwest"):"east"===F?z>=315||45>z?(U=W.width*xi+W.x,p="east"):z>=45&&135>z?(Q=W.height*(1-xi)+W.y,p="north"):z>=135&&225>z?(U=W.width*(1-xi)+W.x,p="west"):(Q=W.height*xi+W.y,p="south"):"south"===F?z>=315||45>z?(Q=W.height*lq+W.y,p="south"):z>=45&&135>z?(U=W.width*lq+W.x,p="east"):z>=135&&225>z?(Q=W.height*(1-lq)+W.y,p="north"):(U=W.width*(1-lq)+W.x,p="west"):"southeast"===F&&(z>=315||45>z?(U=W.width*xi+W.x,Q=W.height*lq+W.y,p="southeast"):z>=45&&135>z?(U=W.width*lq+W.x,Q=W.height*(1-xi)+W.y,p="northeast"):z>=135&&225>z?(U=W.width*(1-xi)+W.x,Q=W.height*(1-lq)+W.y,p="northwest"):(U=W.width*(1-lq)+W.x,Q=W.height*xi+W.y,p="southwest"));var d=Lj(L,U-L.x,Q-L.y,r.getRotation());tb(r,W,p,{x:d.x,y:d.y});var P=gr+X.width*Y.x,A=zo+X.height*Y.y,j={x:P,y:A};j=Lj({x:tp,y:Eq},j.x-tp,j.y-Eq,$),r.p(j.x,j.y)}}),g.fi({kind:"betweenEditRect",event:f,direction:F})}else if(g.$23l&&g.$40l){var br=g.$8l,_j=br.width,oe=br.height,Q={x:br.x+_j/2,y:br.y+oe/2},d=g.$24l,Xc=g.$23l,rf=Xc.x/J-Q.x,_f=Xc.y/J-Q.y,hq=A(rf*rf+_f*_f),Fb=Math.asin(d.x/hq),Fe=O.sm().getSelection(),ie=B+K(q.y-Q.y,q.x-Q.x)-Fb,Dm=O.getSnapAngle(),ie=C(ie/Dm)*Dm;0>ie&&(ie+=i);var Bh=ie-g.$7l,$b=[Q.x,0,Q.y];Fe.each(function(k){if(O.isEditable(k)&&O.isRotationEditable(k)&&O.isVisible(k)){var _=Ln(k.p3(),$b),R=Og();Vc(R,-Bh),k.setRotation(k.getRotation()+Bh),ef(_,R),k.p3($b[0]+_[0],$b[1]+_[1],$b[2]+_[2])}}),g.$7l=ie,g.fi({kind:"betweenEditRotation",event:f})}else if([1,2,3,5,6].indexOf(g.$67l)>=0)g.$72l=f,g.$78l||(g.$78l=1,w(function(){r.isDragging()&&g.$43l(),delete g.$78l},12));else if(7===g.$67l){if(g.$87l instanceof P){var D=g.$87l,Ii=g.$88l,ds=r.clone(D.getPoints().get(Ii)),fn=q.y-ds.y;ds.e||(ds.e=0),g.$92l||(g.$92l=ds.e),ds.e=g.$92l-fn,D.setPoint(Ii,ds)}else if(g.$87l instanceof Y){var b=g.$87l,Ii=g.$88l,z=Yf(O.getDataUI(b),b.s("edge.points")),ds=z.get(Ii),fn=q.y-ds.y;ds.e||(ds.e=0),g.$92l||(g.$92l=ds.e),ds.e=g.$92l-fn,z.set(Ii,ds),b.s("edge.points",Hq(z))}}else if(8===g.$67l){var Fe=O.sm().getSelection(),Id=g.$93l;Id||(Id=g.$93l={}),Fe.each(function(Y){if(Y.p3){var I=Y.p3(),d=Id[Y.getId()];d==_&&(d=Id[Y.getId()]=I[1]),Y.p3([I[0],d-(q.y-g.$90l.y/J),I[2]])}})}else if(9===g.$67l){var Fe=O.sm().getSelection(),ze=g.$94l;ze||(ze=g.$94l={}),Fe.each(function(w){if(w.s3){var y=w.s3(),U=ze[w.getId()];U==_&&(U=ze[w.getId()]=y[1]);var b=U-(q.y-g.$91l.y/J);0>b&&(b=.01),w.s3([y[0],b,y[2]])}})}},$79l:function(X,G){var h=this,Q=h.gv,K=Q.getZoom(),r=Q.getEditHelperSize(),V=X.x/K,x=X.y/K,H=r/K,g=H/2;return I({x:V-g,y:x-g,width:H,height:H},G)?!0:void 0},getHelperCursor:function(){return"crosshair"},_79I:function(j,b){for(var r=this,W=r.gv,U=W.getZoom(),g=W.getEditPointSize(),$=g/U,p=$/2,v=r.$46l(j),q=0;q<v.length;q++){var x,N,D=v[q],T=W.getDataUI(D);if(T&&T._55O){var f=T._55O;if(f._43O&&D instanceof Y){if(x=D.s("edge.points"),x=Yf(T,x),N=D.s("edge.segments"),N&&N.size()||(N=bg(x)),r.$42l(D,b,x._as,N,"edge"))return!0;if("points"===D.s("edge.type"))return r.$41l(D,b,x._as,N,"edge"),void 0}if(f._43O&&D instanceof P&&f.$15l&&f.$15l.length===D.getPoints().size()){if(x=f.$15l,N=D.getSegments(),N&&N.size()||(N=bg(x)),r.$42l(D,b,x,N,"shape"))return!0;if(r.$41l(D,b,x,N,"shape"))return}}}if(r.$16l){var x,C=r.$16l,J=C[3].x-C[7].x,e=C[3].y-C[7].y,H=A(J*J+e*e),d=C[1].x-C[5].x,E=C[1].y-C[5].y,i=A(d*d+E*E),n={x:b.x*U,y:b.y*U};if(r._80I(n,0,C[0],"northwest",H,i)||r._80I(n,1,C[1],"north",H,i)||r._80I(n,2,C[2],"northeast",H,i)||r._80I(n,7,C[7],"west",H,i)||r._80I(n,3,C[3],"east",H,i)||r._80I(n,6,C[6],"southwest",H,i)||r._80I(n,5,C[5],"south",H,i)||r._80I(n,4,C[4],"southeast",H,i))return!0}if(r.$23l){var V=r.$23l,M=V.x/U,L=V.y/U;if(I({x:M-p,y:L-p,width:$,height:$},b))return r.$40l=1,r.$12l=r.getHelperCursor("rotation")||"crosshair",!0}return r.$68l&&r.$79l(r.$68l,b)?(r.$67l=1,r.$12l=r.getHelperCursor("host")||"crosshair",!0):r.$69l&&r.$79l(r.$69l,b)?(r.$67l=2,r.$12l=r.getHelperCursor("parent")||"crosshair",!0):r.$70l&&r.$79l(r.$70l,b)?(r.$67l=3,r.$12l=r.getHelperCursor("edge")||"crosshair",!0):r.$71l&&r.$79l(r.$71l,b)?(r.$67l=4,r.$12l=r.getHelperCursor("remove")||"crosshair",!0):r.$82l&&r.$79l(r.$82l,b)?(r.$67l=5,r.$12l=r.getHelperCursor("source")||"crosshair",!0):r.$83l&&r.$79l(r.$83l,b)?(r.$67l=6,r.$12l=r.getHelperCursor("target")||"crosshair",!0):r._pointElevationHelperPoint&&r.$79l(r._pointElevationHelperPoint,b)?(r.$67l=7,r.$12l=r.getHelperCursor("pointElevation")||"crosshair",!0):r.$90l&&r.$79l(r.$90l,b)?(r.$67l=8,r.$12l=r.getHelperCursor("elevation")||"crosshair",!0):r.$91l&&r.$79l(r.$91l,b)?(r.$67l=9,r.$12l=r.getHelperCursor("tall")||"crosshair",!0):!1},_80I:function(k,h,u,m,B,D){var j=this,J=j.gv,_=J.getEditPointSize(),v=_/2,n=J.sm(),a=J.isDirectionEditable;if(a&&1===n.size()){var Q=n.ld();if(a=a.bind(J),Q instanceof G){if(!a(Q,m))return!1;if("east"===m){if(a(Q,"northeast")&&a(Q,"southeast")&&2*_>=D)return!1}else if("west"===m){if(a(Q,"northwest")&&a(Q,"southwest")&&2*_>=D)return!1}else if("north"===m){if(a(Q,"northwest")&&a(Q,"northeast")&&2*_>=B)return!1}else if("south"===m&&a(Q,"southwest")&&a(Q,"southeast")&&2*_>=B)return!1}}else{if(2*_>=B&&("north"===m||"south"===m))return!1;if(2*_>=D&&("east"===m||"west"===m))return!1}if(I({x:u.x-v,y:u.y-v,width:_,height:_},k)){if(j.$10l!==m){var X=180*j.$7l/c,S="";X>=337.5||22.5>X?S="north":X>=22.5&&67.5>X?S="northeast":X>=67.5&&112.5>X?S="east":X>=112.5&&157.5>X?S="southeast":X>=157.5&&202.5>X?S="south":X>=202.5&&247.5>X?S="southwest":X>=247.5&&292.5>X?S="west":X>=292.5&&337.5>X&&(S="northwest");var p=kj.indexOf(S),S=kj[h-(1-p)+8];switch(S){case"northwest":j.$12l="nwse-resize";break;case"northeast":j.$12l="nesw-resize";break;case"southwest":j.$12l="nesw-resize";break;case"southeast":j.$12l="nwse-resize";break;case"north":j.$12l="ns-resize";break;case"east":j.$12l="ew-resize";break;case"south":j.$12l="ns-resize";break;case"west":j.$12l="ew-resize"}j.$10l=m}return!0}return!1},$42l:function(b,a,_,k,l){var X,g=this,O=g.gv,s=O.getEditPointSize(),i=s/O.getZoom(),K=-1,t={x:a.x,y:a.y,width:0,height:0},G=function(U){"shape"===l?g._shape=b:g._edge=b,g._removePointIndex=U},L=function(O){"shape"===l?g._shape=b:g._edge=b,g.$13l=O,g.$12l="crosshair"};for(n(t,i/2),K=_.length-1,X=k.size()-1;X>=0;X--){var v=k.get(X);if(1===v||2===v)K-=1;else if(3===v){var m=_[K-1];if(I(t,m))return L(K-1),!0;K-=2}else if(4===v){var V=_[K-1],j=_[K-2];if(I(t,V))return L(K-1),!0;if(I(t,j))return L(K-2),!0;K-=3}}for(K=_.length-1,X=k.size()-1;X>=0;X--){var v=k.get(X),o=_[K];if(I(t,o))return G(K),L(K),!0;1===v||2===v?K-=1:3===v?K-=2:4===v&&(K-=3)}return!1},$41l:function(O,h,Q,v,r){var y=this,o=y.gv,s=-1,u=0,m={x:h.x,y:h.y,width:0,height:0},U=function(X,P){y._hoverSegmentIndex=P,y._lp=h,"shape"===r?y._shape=O:y._edge=O};for(n(m,o.getSegmentHoverWidth()/2/o.getZoom()),O instanceof P&&O.isClosePath()&&v.indexOf(5)<0&&(v=new d(v._as),v.add(5));u<v.size();u++){var V=v.get(u);if(1===V){var j=Q[s],$=Q[s+1];if(j){var C=qf(new ym(j.x,j.y),new ym($.x,$.y),new ym(m.x,m.y),new ym(m.x+m.width,m.y+m.height));if(C.$62l===g&&C.points.length>0)return U(C,u),!0}s+=1}else if(2===V){var j=Q[s],$=Q[s+1],C=qf(new ym(j.x,j.y),new ym($.x,$.y),new ym(m.x,m.y),new ym(m.x+m.width,m.y+m.height));if(C.$62l===g&&C.points.length>0)return U(C,u),!0;s+=1}else if(3===V){var j=Q[s],c=Q[s+1],M=Q[s+2],C=Xh(new ym(j.x,j.y),new ym(c.x,c.y),new ym(M.x,M.y),new ym(m.x,m.y),new ym(m.x+m.width,m.y+m.height));if(C.$62l===g)return U(C,u),!0;s+=2}else if(4===V){var j=Q[s],p=Q[s+1],A=Q[s+2],M=Q[s+3],C=Mi(new ym(j.x,j.y),new ym(p.x,p.y),new ym(A.x,A.y),new ym(M.x,M.y),new ym(m.x,m.y),new ym(m.x+m.width,m.y+m.height));if(C.$62l===g)return U(C,u),!0;s+=3}else if(5===V){var j=Q[s],$=Q[0];if(j){var C=qf(new ym(j.x,j.y),new ym($.x,$.y),new ym(m.x,m.y),new ym(m.x+m.width,m.y+m.height));if(C.$62l===g&&C.points.length>0)return U(C,u),!0}}}return!1},addShapePoint:function(S,X,k){var r=this,j=r.gv,I=j.dm(),z=I.getHistoryManager();if(z&&z.beginInteraction(),0===arguments.length&&(S=r._shape||r._edge,X=r._hoverSegmentIndex,k=r._lp),S instanceof P||S instanceof Y){var H=Ej(S,j.getDataUI(S),X);if(!isNaN(X)&&k&&!isNaN(H)){var m=k;if(S instanceof P){var M=S.p(),$=S.getRotation(),o=S.toSegments();o&&o.size()||(o=bg(S.getPoints())),S.isClosePath()&&o.indexOf(5)<0&&(o=new d(o._as),o.add(5));var G=o.get(X),i="addPoint",h="removePointAt";if(2===G||1===G){var n={x:m.x,y:m.y};o.add(G,X),n=Lj(M,n.x-M.x,n.y-M.y,-$),S[i](n,H+1)}else if(3===G){var O=S.getPoints(),u=O.get(H),v=O.get(H+2),n={x:m.x,y:m.y};n=Lj(M,n.x-M.x,n.y-M.y,-$);var y=ar(u,n),x=ar(n,v);o.removeAt(X),o.add(3,X),o.add(3,X),S.setPoint(H+1,n),S[i](x,H+2),S[i](y,H+1)}else if(4===G){var O=S.getPoints(),u=O.get(H),v=O.get(H+3),n={x:m.x,y:m.y};n=Lj(M,n.x-M.x,n.y-M.y,-$);var y=Mr(u,n),x=zn(u,n),e=Mr(n,v),l=zn(n,v);o.removeAt(X),o.add(4,X),o.add(4,X),S[h](H+1),S[h](H+1),S[i](n,H+1),S[i](l,H+2),S[i](e,H+2),S[i](x,H+1),S[i](y,H+1)}else if(5===G){var n={x:m.x,y:m.y};o.add(2,X),n=Lj(M,n.x-M.x,n.y-M.y,-$),S[i](n,H+1)}S.isClosePath()&&o.remove(5),S.setSegments(o);var D=S.getWidth(),N=S.getHeight(),F=S.p().x-D/2,B=S.p().y-N/2;F-=M.x,B-=M.y;var w=Bs(S,{x:F,y:B,width:D,height:N},$,M);S.p(w.x,w.y)}else if(S instanceof Y){if("points"!==S.s("edge.type"))return z&&z.endInteraction(),void 0;var O=S.s("edge.points");o=S.s("edge.segments"),O=Yf(j.getDataUI(S),O),o&&o.size()||(o=bg(O)),o=new d(o._as.slice(0)),O=new d(O._as.slice(0));var G=o.get(X);if(2===G||1===G){var n={x:m.x,y:m.y};o.add(G,X),O.add(n,H+1)}else if(3===G){var u=O.get(H),v=O.get(H+2),n={x:m.x,y:m.y},y=ar(u,n),x=ar(n,v);o.removeAt(X),o.add(3,X),o.add(3,X),O.set(H+1,n),O.add(x,H+2),O.add(y,H+1)}else if(4===G){var u=O.get(H),v=O.get(H+3),n={x:m.x,y:m.y},y=Mr(u,n),x=zn(u,n),e=Mr(n,v),l=zn(n,v);o.removeAt(X),o.add(4,X),o.add(4,X),O.removeAt(H+1),O.removeAt(H+1),O.add(n,H+1),O.add(l,H+2),O.add(e,H+2),O.add(x,H+1),O.add(y,H+1)}S.s("edge.points",Hq(O)),S.s("edge.segments",o)}}}z&&z.endInteraction()},removeShapePoint:function(W,J){var E=this,O="removeAt",B=E.gv,H=B.dm(),c=H.getHistoryManager();if(c&&c.beginInteraction(),0===arguments.length&&(W=E._shape||E._edge,J=E._removePointIndex),J>=0&&(W instanceof P||W instanceof Y)){var x=Cf(W,E.gv.getDataUI(W),J),s=J;if(W instanceof P){var u=W.p(),a=W.toSegments();a&&a.size()||(a=bg(W.getPoints()));var Q=a.get(x),h="removePointAt";if(1===Q&&0===s)if(W.getPoints().size()>1){var T=a.get(x+1);a[O](x+1),3===T?W[h](s+1):4===T&&(W[h](s+2),W[h](s+1)),W[h](s)}else W.dm().remove(W);else 2===Q||1===Q?(a[O](x),W[h](s)):3===Q?(a[O](x),W[h](s),W[h](s-1)):4===Q&&(a[O](x),W[h](s),W[h](s-1),W[h](s-2));W.setSegments(a);var I=W.getWidth(),Z=W.getHeight(),o=W.p().x-I/2,k=W.p().y-Z/2;o-=u.x,k-=u.y;var l=Bs(W,{x:o,y:k,width:I,height:Z},W.getRotation(),u);W.p(l.x,l.y)}else if(W instanceof Y){if("points"!==W.s("edge.type"))return c&&c.endInteraction(),void 0;var w=W.s("edge.points");if(a=W.s("edge.segments"),w&&(w=Yf(E.gv.getDataUI(W),w),a&&a.size()||(a=bg(w))),0===J||J===w.size()-1)return c&&c.endInteraction(),void 0;a=new d(a._as.slice(0)),w=new d(w._as.slice(0));var Q=a.get(x);2===Q||1===Q?(a[O](x),w[O](s)):3===Q?(a[O](x),w[O](s),w[O](s-1)):4===Q&&(a[O](x),w[O](s),w[O](s-1),w[O](s-2)),W.s("edge.segments",a),W.s("edge.points",Hq(w))}}c&&c.endInteraction()},changeShapeSegment:function(Q,l,e){var A=this,U=A.gv,X=U.dm(),S=X.getHistoryManager();if(S&&S.beginInteraction(),1!==arguments.length||isNaN(Q)||(e=Q,Q=A._shape||A._edge,l=A._hoverSegmentIndex),Q instanceof P||Q instanceof Y){var g=Ej(Q,A.gv.getDataUI(Q),l);if(!isNaN(l)&&!isNaN(g))if(Q instanceof P){var c=Q.p(),I=Q.toSegments();I&&I.size()||(I=bg(Q.getPoints()));var h=I.get(l),z=Q.toPoints();if(1===e||2===e)1===h||2===h?I.set(l,e):3===h?(I.set(l,e),z.removeAt(g+1)):4===h&&(I.set(l,e),z.removeAt(g+1),z.removeAt(g+1));else if(3===e){var M=function(){var v=z.get(g),c=z.get(g+1),r=ar(v,c);I.set(l,3),z.add(r,g+1)};2===h||1===h?M():4===h&&(z.removeAt(g+1),z.removeAt(g+1),M())}else if(4===e){var F=function(){var w=z.get(g),S=z.get(g+1),B=Mr(w,S),y=zn(w,S);I.set(l,4),z.add(B,g+1),z.add(y,g+2)};2===h||1===h?F():3===h&&(z.removeAt(g+1),F())}Q.setSegments(I),Q.setPoints(z);var E=Q.getWidth(),f=Q.getHeight(),_=Q.p().x-E/2,B=Q.p().y-f/2;_-=c.x,B-=c.y;var N=new Bs(Q,{x:_,y:B,width:E,height:f},Q.getRotation(),c);Q.p(N.x,N.y)}else if(Q instanceof Y){if("points"!==Q.s("edge.type"))return S&&S.endInteraction(),void 0;var z=Q.s("edge.points");I=Q.s("edge.segments"),z&&(z=Yf(A.gv.getDataUI(Q),z),I&&I.size()||(I=bg(z))),I=new d(I._as.slice(0)),z=new d(z._as.slice(0));var h=I.get(l);if(1===e||2===e)1===h||2===h?I.set(l,e):3===h?(I.set(l,e),z.removeAt(g+1)):4===h&&(I.set(l,e),z.removeAt(g+1),z.removeAt(g+1));else if(3===e){var M=function(){var Y=z.get(g),m=z.get(g+1),M=ar(Y,m);I.set(l,3),z.add(M,g+1)};2===h||1===h?M():4===h&&(z.removeAt(g+1),z.removeAt(g+1),M())}else if(4===e){var F=function(){var k=z.get(g),H=z.get(g+1),e=Mr(k,H),n=zn(k,H);I.set(l,4),z.add(e,g+1),z.add(n,g+2)};2===h||1===h?F():3===h&&(z.removeAt(g+1),F())}Q.s("edge.points",Hq(z)),Q.s("edge.segments",I)}}S&&S.endInteraction()},getDefaultSegments:function(C){var U=this.gv,$=U.getDataUI(C);if(C instanceof Y){var b=C.s("edge.points");return b=Yf($,b),bg(b)}if(C instanceof P){var b=C.getPoints(),J=C.getSegments();return J&&J.size()>0?J:bg(b)}},$43l:function(e){var Z=this;e&&(Z.$5l=1),Z._68I=1,Z._42()},_42:function(){var $=this;if($._68I){delete $._68I;var S=$.gv,e=$.$5l,W=S.getZoom(),Z=S.getEditPointSize(),T=Z/2,M=new d,I=$._view,k=$._edge,K=$._shape,O=I.getContext("2d"),B=S.tx(),f=S.ty(),J=_,q=S.getEditPointBackground(),m=S.getControlPointBackground(),x=S.getControlPointBorderColor(),D=S.getEditPointBorderColor(),C=S.getEditRectBorderColor(),g=S.getDirectionLineColor(),c=S.getSegmentHoverColor(),s=S.getSnapPointBorderColor(),H=S.getJoinPointBackground(),V=S.getJoinPointBorderColor(),F=S.getSegmentHoverWidth(),E=[5,5],a=S.getEditRectBorderStyle();bk(S,function($){S.isSelected($)&&S.isVisible($)&&M.add($)}),O.clearRect(0,0,o(I.width),o(I.height)),O.save(),y.translateAndScale(O,B,f,1);var p=_,Q={x:0,y:0,width:0,height:0},l=0,z=0,N=0,h=0,R=0,w=0,an=0,Ge=0,nh=0,Bk=0,Kp=[];if(e?(delete $.$6l,delete $.$8l,delete $.$7l,delete $.$16l,delete $.$23l):(p=$.$6l,J=$.$7l),delete $.$68l,delete $.$69l,delete $.$71l,delete $.$70l,delete $.$82l,delete $.$83l,delete $._pointElevationHelperPoint,delete $.$90l,delete $.$91l,delete $.$75l,delete $.$74l,M.each(function(D){var O=S.getDataUI(D);if(O){var p=O._55O;if(S.isEditable(D))p._56O&&D instanceof G&&z++,Kp.push(D),p._42O&&D instanceof G&&l++,S.isHelperEditable(D,"host")&&h++,S.isHelperEditable(D,"parent")&&N++,S.isHelperEditable(D,"remove")&&R++,S.isHelperEditable(D,"edge")&&w++,S.isHelperEditable(D,"source")&&an++,S.isHelperEditable(D,"target")&&Ge++,S.isHelperEditable(D,"elevation")&&nh++,S.isHelperEditable(D,"tall")&&Bk++;else if(D instanceof v&&D.isExpanded()){var P=!0,$=S.getEditableFunc();$&&(P=$(D)),P&&(S.isHelperEditable(D,"host")&&h++,S.isHelperEditable(D,"parent")&&N++,S.isHelperEditable(D,"remove")&&R++,S.isHelperEditable(D,"edge")&&w++,S.isHelperEditable(D,"source")&&an++,S.isHelperEditable(D,"target")&&Ge++,S.isHelperEditable(D,"elevation")&&nh++,S.isHelperEditable(D,"tall")&&Bk++,Kp.push(D))}}}),O.beginPath(),O.lineWidth=1,O.strokeStyle=S.getNodeBorderColor(),Kp.forEach(function(i){var N=S.getDataUI(i),x=N._55O;if(e)if(J==_&&(J=i instanceof Y?0:i instanceof v&&i.isExpanded()?0:i.getRotation(),$.$7l=J),p==_){var M,f,h;if(i instanceof v&&i.isExpanded()||i instanceof Y){var q=S.getDataUIBounds(i);f=q.width,h=q.height,M={x:q.x+f/2,y:q.y+h/2}}else M=i.p(),f=i.getWidth(),h=i.getHeight();p={x:M.x,y:M.y,width:0,height:0},Q.x=M.x-f/2,Q.y=M.y-h/2,Q.width=f,Q.height=h,p=U(p,Q)}else{var M,f,h,s,C=p.x+p.width/2,Z=p.y+p.height/2,P={x:C,y:Z};if(i instanceof v&&i.isExpanded()||i instanceof Y){s=0;var q=S.getDataUIBounds(i);f=q.width,h=q.height,M={x:q.x+f/2,y:q.y+h/2}}else M=i.p(),f=i.getWidth(),h=i.getHeight(),s=i.getRotation();var t={x:M.x-f/2,y:M.y-h/2,width:f,height:h},m={x:t.x,y:t.y},D={x:t.x+t.width,y:t.y},j={x:t.x,y:t.y+t.height},u={x:t.x+t.width,y:t.y+t.height},m=Lj(M,m.x-M.x,m.y-M.y,s),j=Lj(M,j.x-M.x,j.y-M.y,s),u=Lj(M,u.x-M.x,u.y-M.y,s),D=Lj(M,D.x-M.x,D.y-M.y,s),V=-J,H=Lj(P,m.x-P.x,m.y-P.y,V),T=Lj(P,D.x-P.x,D.y-P.y,V),A=Lj(P,j.x-P.x,j.y-P.y,V),n=Lj(P,u.x-P.x,u.y-P.y,V),X=b([H,T,A,n]);p=U(p,X),p.x-=C,p.y-=Z;var L=Bs(_,p,J,P);p.x=L.x-p.width/2,p.y=L.y-p.height/2}if(l>1&&S.isEditable(i)&&S.isRectEditable(i)&&i instanceof G){var B=i.getRect(),r=x.$45l,c=He(r[0],W),y=He(r[2],W),K=He(r[4],W),d=He(r[6],W);i.getRotation()?(O.moveTo(c.x,c.y),O.lineTo(y.x,y.y),O.lineTo(K.x,K.y),O.lineTo(d.x,d.y),O.lineTo(c.x,c.y)):O.rect(B.x*W,B.y*W,B.width*W,B.height*W)}}),O.stroke(),p){$.$6l=t(p),n(p,S.getEditRectPadding()/W);var Uh={x:p.x+p.width/2,y:p.y+p.height/2},Yc=Eq(Uh,p.width,p.height,J),sf=Yc[0],$c=Yc[1],xn=Yc[2],gd=Yc[3],pg=Yc[4],_g=Yc[5],Sk=Yc[6],zc=Yc[7];if(sf=He(Yc[0],W),$c=He(Yc[1],W),xn=He(Yc[2],W),gd=He(Yc[3],W),pg=He(Yc[4],W),_g=He(Yc[5],W),Sk=He(Yc[6],W),zc=He(Yc[7],W),$.$8l=p,l>0&&($.$16l=[sf,pg,$c,_g,gd,Sk,xn,zc],O.beginPath(),O.lineWidth=1,O.strokeStyle=C,"dashed"===a&&O.setLineDash&&O.setLineDash(E),O.moveTo(sf.x,sf.y),O.lineTo($c.x,$c.y),O.lineTo(gd.x,gd.y),O.lineTo(xn.x,xn.y),O.lineTo(sf.x,sf.y),O.stroke(),"dashed"===a&&O.setLineDash&&O.setLineDash([])),O.beginPath(),O.lineWidth=1,O.fillStyle=q,O.strokeStyle=D,l>0){var ak=_g.x-zc.x,Ae=_g.y-zc.y,sq=A(ak*ak+Ae*Ae),fq=pg.x-Sk.x,Qd=pg.y-Sk.y,Up=A(fq*fq+Qd*Qd),qe=2*Z;if(S.isDirectionEditable&&1===Kp.length){var Qq=Kp[0],xf=S.getDataUI(Qq),Zi=xf._55O,Ui=S.isDirectionEditable.bind(S);if(Zi._42O){var Yh,ld,Ep,jo;Ui(Qq,"northwest")&&(Yh=!0,O.rect(sf.x-T,sf.y-T,Z,Z)),Ui(Qq,"northeast")&&(ld=!0,O.rect($c.x-T,$c.y-T,Z,Z)),Ui(Qq,"southwest")&&(Ep=!0,O.rect(xn.x-T,xn.y-T,Z,Z)),Ui(Qq,"southeast")&&(jo=!0,O.rect(gd.x-T,gd.y-T,Z,Z)),Ui(Qq,"north")&&(Yh&&ld?sq>qe&&O.rect(pg.x-T,pg.y-T,Z,Z):O.rect(pg.x-T,pg.y-T,Z,Z)),Ui(Qq,"south")&&(jo&&Ep?sq>qe&&O.rect(Sk.x-T,Sk.y-T,Z,Z):O.rect(Sk.x-T,Sk.y-T,Z,Z)),Ui(Qq,"west")&&(Ep&&Yh?Up>qe&&O.rect(zc.x-T,zc.y-T,Z,Z):O.rect(zc.x-T,zc.y-T,Z,Z)),Ui(Qq,"east")&&(jo&&ld?Up>qe&&O.rect(_g.x-T,_g.y-T,Z,Z):O.rect(_g.x-T,_g.y-T,Z,Z))}}else sq>qe&&(O.rect(pg.x-T,pg.y-T,Z,Z),O.rect(Sk.x-T,Sk.y-T,Z,Z)),Up>qe&&(O.rect(_g.x-T,_g.y-T,Z,Z),O.rect(zc.x-T,zc.y-T,Z,Z)),O.rect(sf.x-T,sf.y-T,Z,Z),O.rect($c.x-T,$c.y-T,Z,Z),O.rect(xn.x-T,xn.y-T,Z,Z),O.rect(gd.x-T,gd.y-T,Z,Z)}if(z>0){var Bc=$.$23l=Lj(pg,0,2*-Z,J);O.moveTo(Bc.x+T,Bc.y),O.arc(Bc.x,Bc.y,T,0,i,!1)}O.fill(),O.stroke(),$.$40l&&$.$44l(O,p,J);var bb,Bp,Fr=S.getLeftTopHelpers(),lc=S.getRightTopHelpers(),wc=S.getLeftBottomHelpers(),ds=S.getRightBottomHelpers(),Ad=S.getEdgeHelpers(),tn=S.getEditHelperSize(),Nd=tn/2,ls=function(t,y,j,s){"leftTop"===y?(bb=p.x*W-tn-T-("h"===s?j*(tn+T):0)-1,Bp=p.y*W-tn-T-("v"===s?j*(tn+T):0)-1):"rightTop"===y?(bb=(p.x+p.width)*W+T+("h"===s?j*(tn+T):0)+1,Bp=p.y*W-tn-T-("v"===s?j*(tn+T):0)-1):"leftBottom"===y?(bb=p.x*W-tn-T-("h"===s?j*(tn+T):0)-1,Bp=(p.y+p.height)*W+T+("v"===s?j*(tn+T):0)+1):"rightBottom"===y&&(bb=(p.x+p.width)*W+T+("h"===s?j*(tn+T):0)+1,Bp=(p.y+p.height)*W+T+("v"===s?j*(tn+T):0)+1);var z=bb+Nd,D=Bp+Nd,a=(p.x+p.width/2)*W,K=(p.y+p.height/2)*W,Z=Lj({x:a,y:K},z-a,D-K,J);if("host"===t){if(h>0)return $.$77l(O,J,Z),!0}else if("edge"===t){if(w>0)return $.$80l(O,J,Z),!0}else if("remove"===t){if(R>0)return Kp&&1===Kp.length&&Kp[0]instanceof Y?$.$81l(O,J,{x:a+tn/2+5,y:K}):$.$81l(O,J,Z),!0}else if("parent"===t){if(N>0)return Kp&&1===Kp.length&&Kp[0]instanceof Y?$.$76l(O,J,{x:a-tn/2-5,y:K}):$.$76l(O,J,Z),!0}else if("elevation"===t){if(nh>0)return $.$85l(O,J,Z),!0}else if("tall"===t){if(Bk>0)return $.$86l(O,J,Z),!0}else if("source"===t||"target"===t){var V=Kp[0],x=S.getDataUI(V),i=zd(x,!0),U=i[0],c=i[1];if(an&&"source"===t)return $.$84l(O,p,U,!0,V.isLooped(),y,j,s),!0;if(Ge&&"target"===t)return $.$84l(O,p,c,!1,V.isLooped(),y,j,s),!0}};if(Fr&&Fr.length>0){var Jg=0;Fr.forEach(function(Q){ls(Q,"leftTop",Jg,S.getLeftTopHelpersAlign()||"h")&&Jg++})}if(lc&&lc.length>0){var Jg=0;lc.forEach(function(N){ls(N,"rightTop",Jg,S.getRightTopHelpersAlign()||"h")&&Jg++})}if(wc&&wc.length>0){var Jg=0;wc.forEach(function(j){ls(j,"leftBottom",Jg,S.getLeftBottomHelpersAlign()||"h")&&Jg++})}if(ds&&ds.length>0){var Jg=0;ds.forEach(function(V){ls(V,"rightBottom",Jg,S.getRightBottomHelpersAlign()||"h")&&Jg++})}if(Ad&&Ad.length>0&&((an||Ge)&&Kp&&1===Kp.length&&Kp[0]instanceof Y?!0:!1)){var Jg=0;Ad.forEach(function(E){ls(E,"edge",Jg,"h")&&Jg++})}if($.$72l){var Ei,fo=$.$67l,ks=$.$68l,jk=$.$69l,zm=($.$71l,$.$70l),vi=$.$82l,ib=$.$83l;if(1===fo?Ei=ks:2===fo?Ei=jk:3===fo?Ei=zm:5===fo?Ei=vi:6===fo&&(Ei=ib),Ei){var db=S.lp($.$72l),vd=S.getDataAt($.$72l);if(vd&&vd instanceof G){var $j,Pj,xh;if($.$73l=vd,1===fo)if(vd instanceof u.Grid)$j=$.$75l=Rc(vd,db);else if(vd instanceof u.Shape){xh=$.$74l=Wj(vd,db);var zb=vd.getPoints();if(xh){var bn=xh.attachIndex,Wr=Ej(vd,S.getDataUI(vd),bn)+1,ro=Wr+1>=zb.size()?0:Wr+1,gc=zb.get(Wr),Fl=zb.get(ro),Eh=vd.p(),Kb=vd.getRotation();gc=Lj(Eh,gc.x-Eh.x,gc.y-Eh.y,Kb),Fl=Lj(Eh,Fl.x-Eh.x,Fl.y-Eh.y,Kb),O.beginPath(),O.strokeStyle=c,O.lineWidth=F,O.moveTo(gc.x*W,gc.y*W),O.lineTo(Fl.x*W,Fl.y*W),O.stroke()}}$j?Pj=$j.rect:(Pj=r.clone(S.getDataUIBounds(vd)),r.grow(Pj,2)),O.beginPath(),O.rect(Pj.x*W,Pj.y*W,Pj.width*W,Pj.height*W),O.strokeStyle=1===fo||4===fo||6===fo?L:j,O.lineWidth=2,O.setLineDash&&O.setLineDash([8,8]),O.stroke()}else delete $.$73l;db.x=db.x*W,db.y=db.y*W;var ah=_d(Ei.x,Ei.y,db.x,db.y),sg=Lj(Ei,db.x-Ei.x,db.y-Ei.y,-ah),Qh=sg.x-Ei.x;O.translate(Ei.x,Ei.y),O.rotate(ah),X.width=Qh,X.height=40;var xk=j;(1===fo||4===fo||6===fo)&&(xk=L),X.comps[0].gradientColor=xk,r.drawImage(O,X,0,-20,Qh,40)}}}if(M.each(function(t){var Y=S.getDataUI(t);if(Y){var l,z,y=Y._55O,b=Y._78o;if(y&&y._43O&&t instanceof P?(l=y.$15l,z=t.getSegments(),z&&z.size()||(z=bg(l)),t.isClosePath()&&z.indexOf(5)<0&&(z=new d(z._as),z.add(5))):y&&b&&y._43O&&(l=t.s("edge.points"),z=t.s("edge.segments"),l=Yf(Y,l),z&&z.size()||(z=bg(l)),l&&(l=l._as)),l&&z){var B=0,j=z.size(),Q=$._hoverSegmentIndex;l=l.slice(0);for(var w=0;w<l.length;w++)l[w]=He(l[w],W);O.beginPath(),O.strokeStyle=g,O.lineWidth=1,B=0;for(var w=0;j>w;w++){var L=z.get(w);if(1===L||2===L)B++;else if(3===L){var a=l[B-1],N=l[B],A=l[B+1];O.moveTo(a.x,a.y),O.lineTo(N.x,N.y),O.lineTo(A.x,A.y),B+=2}else if(4===L){var a=l[B-1],E=l[B],M=l[B+1],A=l[B+2];O.moveTo(a.x,a.y),O.lineTo(E.x,E.y),O.moveTo(M.x,M.y),O.lineTo(A.x,A.y),B+=3}}if(O.stroke(),K===t||k===t&&"points"===k.s("edge.type")){O.beginPath(),B=0,O.strokeStyle=c,O.lineWidth=F;for(var w=0;j>w;w++){var L=z.get(w);if(1===L||2===L){if(Q===w){var a=l[B-1],A=l[B];O.moveTo(a.x,a.y),O.lineTo(A.x,A.y);break}B++}else if(3===L){if(Q===w){var a=l[B-1],N=l[B],A=l[B+1];O.moveTo(a.x,a.y),O.quadraticCurveTo(N.x,N.y,A.x,A.y);break}B+=2}else if(4===L){if(Q===w){var a=l[B-1],E=l[B],M=l[B+1],A=l[B+2];O.moveTo(a.x,a.y),O.bezierCurveTo(E.x,E.y,M.x,M.y,A.x,A.y);break}B+=3}else if(5===L&&Q===w){var a=l[B-1],A=l[0];O.moveTo(a.x,a.y),O.lineTo(A.x,A.y);break}}O.stroke()}O.beginPath(),B=0,O.strokeStyle=V,O.lineWidth=1,O.fillStyle=H;for(var w=0;j>w;w++){var L=z.get(w);if(1===L||2===L){var A=l[B];O.moveTo(A.x+T,A.y),O.arc(A.x,A.y,T,0,i,!0),B++}else if(3===L){var A=l[B+1];O.moveTo(A.x+T,A.y),O.arc(A.x,A.y,T,0,i,!0),B+=2}else if(4===L){var A=l[B+2];O.moveTo(A.x+T,A.y),O.arc(A.x,A.y,T,0,i,!0),B+=3}}O.fill(),O.stroke(),O.beginPath(),B=0,O.strokeStyle=x,O.lineWidth=1,O.fillStyle=m;for(var w=0;j>w;w++){var L=z.get(w);if(1===L||2===L)B++;else if(3===L){var N=l[B];O.moveTo(N.x+T,N.y),O.arc(N.x,N.y,T,0,i,!0),B+=2}else if(4===L){var E=l[B],M=l[B+1];O.moveTo(E.x+T,E.y),O.arc(E.x,E.y,T,0,i,!0),O.moveTo(M.x+T,M.y),O.arc(M.x,M.y,T,0,i,!0),B+=3}}if(O.fill(),O.stroke(),O.beginPath(),B=0,O.strokeStyle=s,O.lineWidth=2,(K===t||k===t)&&$.$9l!=_){var A=l[$.$9l];O.moveTo(A.x+T,A.y),O.arc(A.x,A.y,T,0,i,!0),O.stroke()}}}}),$.$87l&&S.sm().contains($.$87l)){var nq,vm=$.$87l,sb=$.$88l,tn=S.getEditHelperSize(),Nd=tn/2;if(S.isHelperEditable(vm,"pointElevation"))if(vm instanceof P){var ue=vm.getPosition();nq=r.clone(vm.getPoints().get(sb)),nq=Lj({x:ue.x,y:ue.y},nq.x-ue.x,nq.y-ue.y,vm.getRotation()),nq.x*=W,nq.y*=W,O.translate(nq.x,nq.y),r.drawImage(O,zh,Nd,-Nd,tn,tn),O.translate(-nq.x,-nq.y),$._pointElevationHelperPoint={x:nq.x+tn,y:nq.y}}else if(vm instanceof Y){var Kc=Yf(S.getDataUI(vm),vm.s("edge.points")),nq=r.clone(Kc.get(sb));nq.x*=W,nq.y*=W,O.translate(nq.x,nq.y),r.drawImage(O,zh,Nd,-Nd,tn,tn),O.translate(-nq.x,-nq.y),$._pointElevationHelperPoint={x:nq.x+tn,y:nq.y}}}O.restore(),$.$5l=0}},$89l:function(C,k,F,K){C.save();var d=this,E=d.gv,e=E.getEditHelperSize(),N=e/2;C.beginPath(),C.translate(F.x,F.y),C.rotate(k),r.drawImage(C,K,-N,-N,e,e),C.restore()},$85l:function($,G,i){var X=this;X.$90l=i,X.$89l($,G,i,zh)},$86l:function(q,E,O){var I=this;I.$91l=O,I.$89l(q,E,O,Rq)},$77l:function(I,D,M){var V=this;V.$68l=M,V.$89l(I,D,M,e)},$80l:function(K,Q,A){var p=this;p.$70l=A,p.$89l(K,Q,A,Z)},$81l:function(t,F,n){var S=this;S.$71l=n,S.$89l(t,F,n,Hg)},$76l:function(z,N,_){var F=this;F.$69l=_,F.$89l(z,N,_,q)},$84l:function(m,V,u,C,Q){var z,l=this,D=l.gv,q=D.getZoom(),k=D.getEditHelperSize(),Y=k/2;u.x*=q,u.y*=q,Q&&(C?u.x-=Y+5:u.x+=Y+5),u.y-=k-2,C?(l.$82l=u,z=Tl):(l.$83l=u,z=yl),m.beginPath(),m.translate(u.x,u.y),r.drawImage(m,z,-Y,-Y,k,k),m.translate(-u.x,-u.y)},$44l:function(v,H,i){v.save();var f=this.gv.getZoom(),a=A(S(H.width,2)+S(H.height,2))/2*f+10,k=a,F=k+8,T=k+18,E=i,s=H.x+H.width/2,D=H.y+H.height/2;v.translate(s*f,D*f),v.beginPath(),v.strokeStyle="rgb(150, 150, 150)";for(var L=0,o=0,d=0,y=0,e=0,O=0;360>O;O++)L=O*c/180,0===O%5&&(o=h(L)*k,d=M(L)*k,y=h(L)*F,e=M(L)*F,v.moveTo(o,d),v.lineTo(y,e)),0===O%45&&(o=h(L)*k,d=M(L)*k,y=h(L)*T,e=M(L)*T,v.moveTo(o,d),v.lineTo(y,e));v.stroke(),v.beginPath(),v.rotate(-B),v.beginPath(),v.fillStyle="rgba(255, 0, 0, 0.1)",v.strokeStyle="rgb(157, 157, 157)",v.moveTo(0,0),v.arc(0,0,T,0,i,!1),v.fill(),v.beginPath(),v.moveTo(0+T,0),v.arc(0,0,T,0,i,!1),v.stroke(),v.rotate(B),v.font="bold 12px Verdana, Arial";var G=20*M(E),X=20*h(E),P=C(180*E/c)+"°";v.textAlign="center",v.textBaseline="middle",v.beginPath();var l=v.measureText("365.°").width;v.fillStyle="white",v.rect(G-l/2,-X-10,l,20),v.fill(),v.beginPath(),v.fillStyle="rgb(79,79,79)",v.fillText(P,G,-X),v.restore()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);