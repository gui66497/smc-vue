!function(P,W){"use strict";var j="ht",u=P[j],R=u.Default,r=R.def,q="add",i="remove",J=R.getInternal(),h="propertyChange";u.HistoryManager=function(p){this._histories=[],this.setDataModel(p)},r(u.HistoryManager,W,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var U=this;U.$4p++,1===U.$4p&&(U.$3p=[])},endInteraction:function(){var T=this,F=T._histories,j=T._historyIndex,M=T.$3p;T.$4p>0&&T.$4p--,0===T.$4p&&(delete T.$3p,M&&M.length&&(F=F.slice(0,j+1),F.push(M),F.length>T._maxHistoryCount&&(F=F.slice(F.length-T._maxHistoryCount)),T.setHistories(F),T.setHistoryIndex(F.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(N){var w=this,d=w._dataModel;d!==N&&(d&&(delete d._historyManager,d.umm(w.$5p,w),d.umd(w.$6p,w)),w._dataModel=N,N._historyManager=w,N.mm(w.$5p,w),N.md(w.$6p,w),w.fp("dataModel",d,N),w.clear())},setHistoryIndex:function(d,R){var $=this,T=$._historyIndex,j=$._histories.length;if(-1>d?d=-1:d>=j&&(d=j-1),T!==d){if(!R){var i=d-T;i>0?$.$2p(i):0>i&&$.$1p(-i)}$._historyIndex=d,$.fp("historyIndex",T,d)}},setMaxHistoryCount:function(o){var q=this,N=q._histories,h=q._maxHistoryCount;(!o||0>=o)&&(o=10),h!==o&&(q._maxHistoryCount=o,q.fp("maxHistoryCount",h,o),N.length>o&&q.clear())},$5p:function(J){if(!this.$7p&&!this.$8p){var H,g,u=this,r=u._histories,p=J.kind,z=J.property,t=u._historyIndex;if(p===q||p===i?g={type:J.kind,data:J.data}:z&&"children"!==z&&"attaches"!==z&&"shape"!==z&&(g={type:h,data:J.data,property:z,oldValue:J.oldValue,newValue:J.newValue}),g)if(u.$4p){H=u.$3p;var w=!1;if(g.type===h)for(var B=H.length-1;B>=0;B--){var C=H[B];if(C.type!==h)break;g.property===C.property&&C.property&&g.data===C.data&&(g.oldValue=C.oldValue,H[B]=g,w=!0)}w||H.push(g)}else H=[g],r=r.slice(0,t+1),r.push(H),r.length>u._maxHistoryCount&&(r=r.slice(r.length-u._maxHistoryCount)),u.setHistories(r),u.setHistoryIndex(r.length-1,!0)}},$6p:function(m){this.$5p(m)},undo:function(N){(!N||0>=N)&&(N=1),this.setHistoryIndex(this._historyIndex-N)},$1p:function(X){var M,W=this,l=W._dataModel,_=W._histories,s=W._historyIndex;for(W.$7p=1,R.setIsolating(!0);X>0;){if(s>=0&&s<_.length){M=_[s],s--;for(var F=M.length-1;F>=0;F--){var b=M[F],N=b.type,Q=b.data,Z=b.property,O=b.oldValue;if(N===q)l.remove(Q);else if(N===i)l.add(Q);else{var f=null;0===Z.indexOf("a:")?(f="attr",Z=Z.replace("a:","")):0===Z.indexOf("s:")&&(f="style",Z=Z.replace("s:","")),J.setPropertyValue(Q,f,Z,O)}}}X--}R.setIsolating(!1),delete W.$7p},redo:function(e){(!e||0>=e)&&(e=1),this.setHistoryIndex(this._historyIndex+e)},$2p:function(t){var s,M=this,H=M._dataModel,j=M._histories,K=M._historyIndex;for(M.$7p=1,R.setIsolating(!0);t>0;){if(K>=-1&&K<j.length-1){K++,s=j[K];for(var f=0;f<s.length;f++){var w=s[f],k=w.type,G=w.data,$=w.property,c=w.newValue;if(k===q)H.add(G);else if(k===i)H.remove(G);else{var S=null;0===$.indexOf("a:")?(S="attr",$=$.replace("a:","")):0===$.indexOf("s:")&&(S="style",$=$.replace("s:","")),J.setPropertyValue(G,S,$,c)}}}t--}R.setIsolating(!1),delete M.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);