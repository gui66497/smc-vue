!function(h,$,q){"use strict";var v=h.ht;v.Astar={},function(G){var c=G();h.AStar=c.astar,h.AStar.Graph=c.Graph}(function(){function W(P){for(var W=P,t=[];W.parent;)t.unshift(W),W=W.parent;return t}function u(){return new D(function(U){return U.f})}function H(i,V){V=V||{},this.nodes=[],this.diagonal=!!V.diagonal,this.grid=[];for(var L=0;L<i.length;L++){this.grid[L]=[];for(var R=0,n=i[L];R<n.length;R++){var v=new I(L,R,n[R]);this.grid[L][R]=v,this.nodes.push(v)}}this.$13x()}function I(R,p,J){this.x=R,this.y=p,this.weight=J}function D(c){this.content=[],this.scoreFunction=c}var o={search:function(c,d,T,P){c.$6x(),P=P||{};var D=P.heuristic;D||(D=c.diagonal?o.$4x.diagonal:o.$4x.manhattan);var b=P.closest||!1,t=P.punish,A=u(),G=d;for(d.h=D(d,T),c.$7x(d),A.push(d);A.size()>0;){var y=A.pop();if(y===T)return W(y);y.closed=!0;for(var M=c.neighbors(y),Y=0,r=M.length;r>Y;++Y){var H=M[Y];if(!H.closed&&!H.$9x()){var m=y.g+H.getCost(y,t),v=H.visited;(!v||m<H.g)&&(H.visited=!0,H.parent=y,H.h=H.h||D(H,T),H.g=m,H.f=H.g+H.h,c.$7x(H),b&&(H.h<G.h||H.h===G.h&&H.g<G.g)&&(G=H),v?A.$10x(H):A.push(H))}}}return b?W(G):[]},$4x:{manhattan:function(q,W){var I=Math.abs(W.x-q.x),a=Math.abs(W.y-q.y);return I+a},diagonal:function(d,P){var l=1,D=Math.sqrt(2),M=Math.abs(P.x-d.x),B=Math.abs(P.y-d.y);return l*(M+B)+(D-2*l)*Math.min(M,B)}},$5x:function(P){P.f=0,P.g=0,P.h=0,P.visited=!1,P.closed=!1,P.parent=null}};return H.prototype.$13x=function(){this.dirtyNodes=[];for(var h=0;h<this.nodes.length;h++)o.$5x(this.nodes[h])},H.prototype.$6x=function(){for(var W=0;W<this.dirtyNodes.length;W++)o.$5x(this.dirtyNodes[W]);this.dirtyNodes=[]},H.prototype.$7x=function(A){this.dirtyNodes.push(A)},H.prototype.neighbors=function(Z){var N=[],Q=Z.x,g=Z.y,E=this.grid;return E[Q-1]&&E[Q-1][g]&&N.push(E[Q-1][g]),E[Q+1]&&E[Q+1][g]&&N.push(E[Q+1][g]),E[Q]&&E[Q][g-1]&&N.push(E[Q][g-1]),E[Q]&&E[Q][g+1]&&N.push(E[Q][g+1]),this.diagonal&&(E[Q-1]&&E[Q-1][g-1]&&N.push(E[Q-1][g-1]),E[Q+1]&&E[Q+1][g-1]&&N.push(E[Q+1][g-1]),E[Q-1]&&E[Q-1][g+1]&&N.push(E[Q-1][g+1]),E[Q+1]&&E[Q+1][g+1]&&N.push(E[Q+1][g+1])),N},H.prototype.toString=function(){for(var y=[],Y=this.grid,j=0;j<Y.length;j++){for(var A=[],q=Y[j],D=0;D<q.length;D++)A.push(q[D].weight);y.push(A.join(" "))}return y.join("\n")},I.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},I.prototype.getCost=function(v,S){var W;if(W=v&&v.x!=this.x&&v.y!=this.y?1.41421*this.weight:this.weight,S){var A=v;if(!A)return W;var I=A.parent;return I?Math.abs(I.x+this.x-2*A.x)>1e-5?W+S:Math.abs(I.y+this.y-2*A.y)>1e-5?W+S:W:W}},I.prototype.$9x=function(){return 0===this.weight},D.prototype={push:function(f){this.content.push(f),this.$11x(this.content.length-1)},pop:function(){var r=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.$12x(0)),r},remove:function(u){var r=this.content.indexOf(u),X=this.content.pop();r!==this.content.length-1&&(this.content[r]=X,this.scoreFunction(X)<this.scoreFunction(u)?this.$11x(r):this.$12x(r))},size:function(){return this.content.length},$10x:function(m){this.$11x(this.content.indexOf(m))},$11x:function(e){for(var H=this.content[e];e>0;){var n=(e+1>>1)-1,C=this.content[n];if(!(this.scoreFunction(H)<this.scoreFunction(C)))break;this.content[n]=H,this.content[e]=C,e=n}},$12x:function(o){for(var _=this.content.length,e=this.content[o],d=this.scoreFunction(e);;){var x,L=o+1<<1,G=L-1,i=null;if(_>G){var k=this.content[G];x=this.scoreFunction(k),d>x&&(i=G)}if(_>L){var l=this.content[L],X=this.scoreFunction(l);(null===i?d:x)>X&&(i=L)}if(null===i)break;this.content[o]=this.content[i],this.content[i]=e,o=i}}},{astar:o,Graph:H}});var B=v.Astar.Finder=function(y,x){var K=this;K.gv=y,K.$13x(x),K.refreshMap()};B.prototype={},B.prototype.constructor=B,$.defineProperties(B.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(Y){this.gv._astarDebugInfo=Y}}}),B.prototype.$13x=function(C){var M=this,U=M.$14x={};C=C||{};var Q=C.gridSize||10;U.gridSizeX=C.gridSizeX||Q,U.gridSizeY=C.gridSizeY||Q,U.rect=C.rect,U.filter=C.filter,U.extendBlocks=C.extendBlocks||3,U.fastOverlap=C.fastOverlap===q?!0:C.fastOverlap,U.nodeRectExtend=C.nodeRectExtend||0,U.diagonal=C.diagonal===q?!0:C.diagonal,U.turnPunish=C.turnPunish===q?.1:C.turnPunish,U.simplify=C.simplify===q?!0:C.simplify,U.toGridCenter=C.toGridCenter===q?!1:C.toGridCenter,U.closest=C.closest===q?!0:C.closest},B.prototype.refreshMap=function(){var N,o=this,q=o.$14x,I=q.gridSizeX,R=q.gridSizeY,D=q.extendBlocks;q.rect?N=q.rect:(N=o.$15x(),v.Default.grow(N,I*D,R*D)),v.Default.grow(N,I,R);var y=Math.floor(N.x/I)*I,f=Math.floor(N.y/R)*R,B=Math.ceil(N.width/I),K=Math.ceil(N.height/R),Z=B*I,b=K*R;o.$16x={x:y,y:f,w:Z,h:b,gridX:I,gridY:R,xLen:B,yLen:K},o.$17x(),o.$21x()},B.prototype.$15x=function(){var $=this.gv;if($ instanceof v.graph.GraphView)return $.getContentRect();var m,y=v.Default.unionRect;return $.dm().each(function(O){$.isVisible(O)&&O.getRect&&(m=y(m,O.getRect()))}),m},B.prototype.$17x=function(){var j,r,l,q,_=this,s=_.$16x,X=s.xLen,U=s.yLen;for(j=new Array(X),l=0;X>l;l++)for(j[l]=r=new Array(U),q=U;q--;)r[q]=1;var A=_.$14x.filter;for(_.gv.dm().each(function(V){A&&A(V)===!1||(!_._debugInfo||V!==_._debugInfo.grid&&V!=_._debugInfo.path)&&_.$1cw(j,V)}),l=0;X>l;l++)j[l][0]=1,j[l][U-1]=1;for(q=0;U>q;q++)j[0][q]=1,j[X-1][q]=1;_.grid=j;var $=new AStar.Graph(j,{diagonal:_.$14x.diagonal});_.graph=$},B.prototype.$18x=function(E,S,W,m,w,q,T,F){var s=this.$19x,i=s(W-E,w-T,m-S,q-F);if(1e-6>=i&&i>=-1e-6)return!1;var J=s(w-E,w-T,q-S,q-F)/i;if(0>J||J>1)return!1;var a=s(W-E,w-E,m-S,q-S)/i;return 0>a||a>1?!1:!0},B.prototype.$19x=function(x,G,d,M){return x*M-G*d},B.prototype.$1aw=function(b,Y,n,D){for(var h=[-(Y[1]-b[1]),Y[0]-b[0]],c=h[0]*(n[0]-b[0])+h[1]*(n[1]-b[1])>=0,k=0,S=D.length;S>k;k+=2)if(h[0]*(D[k]-b[0])+h[1]*(D[k+1]-b[1])>=0===c)return!1;return!0},B.prototype.$1bw=function(w,B){for(var q,X,P=this,H=0,Y=w.length;Y>H;H+=2)if(q=H===Y-2?0:H+2,X=q===Y-2?0:q+2,P.$1aw([w[H],w[H+1]],[w[q],w[q+1]],[w[X],w[X+1]],B))return!1;for(var H=0,Y=B.length;Y>H;H+=2)if(q=H===Y-2?0:H+2,X=q===Y-2?0:q+2,P.$1aw([B[H],B[H+1]],[B[q],B[q+1]],[B[X],B[X+1]],w))return!1;return!0},B.prototype.$1cw=function(D,c){if(c.getRect){var P=this,w=c.getRect();v.Default.grow(w,P.$14x.nodeRectExtend);var K,U,s,L,q,t,C,O,H,m,F,b=P.$1dw({x:w.x,y:w.y}),j=P.$1dw({x:w.x+w.width,y:w.y+w.height}),e=P.$14x.fastOverlap;if(!e){var Q=c.getCorners();C=[],Q.forEach(function(c){C.push(c.x,c.y)}),m=P.$14x.gridSizeX/2,F=P.$14x.gridSizeY/2}for(U=Math.max(0,b.x),s=Math.min(j.x,D.length-1),q=Math.max(0,b.y),t=Math.min(j.y,D.length?D[0].length-1:-1),K=U;s>=K;K++)for(L=q;t>=L;L++)if(e)D[K][L]=0;else{H=P.$1ew({x:K,y:L});var R=H.x-m,J=H.x+m,i=H.y-F,$=H.y+F;O=[R,i,R,$,J,$,J,i],P.$1bw(C,O)&&(D[K][L]=0)}}},B.prototype.$1dw=function(q,m){var T=this,V=T.$16x,K=(q.x-V.x)/V.gridX,k=(q.y-V.y)/V.gridY;return m!==!1&&(K=Math.round(K),k=Math.round(k)),{x:K,y:k}},B.prototype.$1ew=function(v){var E=this,P=E.$16x;return{x:v.x*P.gridX+P.x,y:v.y*P.gridY+P.y}},B.prototype.$1fw=function(A){var Q=this,p=Q.$16x,M=p.xLen,$=p.yLen;if(A.x>=0&&A.x<M&&A.y>=0&&A.y<$)return A;var s={x:A.x,y:A.y};return s.x<0?s.x=0:s.x>=M&&(s.x=M-1),s.y<0?s.y=0:s.y>=$&&(s.y=$-1),s},B.prototype.findPath=function(b,f){var c,D,S,w,W=this,u=W.$1dw(b),N=W.$1dw(f);if(S=W.$1fw(u),w=W.$1fw(N),S!==u&&w!==N){var j=W.$16x,B=j.x-j.gridX/2,M=j.y-j.gridY/2,F=B+j.gridX*j.xLen,Y=M+j.gridY*j.yLen;if(!(W.$18x(b.x,b.y,f.x,f.y,B,M,F,M)||W.$18x(b.x,b.y,f.x,f.y,F,M,F,Y)||W.$18x(b.x,b.y,f.x,f.y,F,Y,B,Y)||W.$18x(b.x,b.y,f.x,f.y,B,Y,B,M)))return[b,f]}S!==u&&(c=!0,u=S),w!==N&&(D=!0,N=w);var $=W.graph.grid[u.x][u.y],E=W.graph.grid[N.x][N.y],y=AStar.search(W.graph,$,E,{closest:W.$14x.closest,punish:W.$14x.turnPunish});if(!y||!y.length)return null;var L=[];L.push(b),c&&L.push(W.$1ew(y[0]));for(var r=1,p=y.length;p-1>r;r++)L.push(W.$1ew(y[r]));if(D)L.push(W.$1ew(y[p-1])),L.push(f);else{var h=y[p-1];N.x!==h.x||N.y!==h.y||W.$14x.toGridCenter?L.push(W.$1ew(h)):L.push(f)}return W.$14x.simplify&&(L=W.simplifyPath(L)),W.$20x=L,W.$21x(),L},B.prototype.debugOn=function(M){this.debugFlag=!0,this.debugSettings=M||{},this.$21x()},B.prototype.simplifyPath=function(d){var p=d.length;if(2>=p)return d;var s,U,N=[d[0],d[1]],P=N[0],e=N[1],A=1e-5;for(s=2;p>s;s++)U=d[s],Math.abs((e.x-P.x)*(U.y-P.y)-(e.y-P.y)*(U.x-P.x))<A?e=N[N.length-1]=U:(P=e,e=U,N.push(U));return N},B.prototype.$21x=function(){var y=this;if(y.$22x(),this.debugFlag){var R=y.grid;if(R){var j,q=y.gv;if(y.debugSettings.$16x!==!1){j=[];for(var r,Q,z,S,P,m=[],w=y.$14x.gridSizeX/2,T=y.$14x.gridSizeY/2,n=R.length,i=n?R[0].length:0,G=1;n-1>G;G++)for(var x=1;i-1>x;x++)R[G][x]||(r=y.$1ew({x:G,y:x}),Q=r.x-w,z=r.x+w,S=r.y-T,P=r.y+T,j.push({x:Q,y:S},{x:Q,y:P},{x:z,y:P},{x:z,y:S}),m.push(1,2,2,2,5));var k=new v.Shape;k.s("shape.border.color","rgba(50, 50, 50, 0.2)"),k.s("shape.border.width",1),k.s("shape.background","rgba(200, 50, 100, 0.2)"),k.s("2d.editable",!1),k.s("2d.selectable",!1),k.setPoints(j),k.setSegments(m),y._debugInfo={grid:k},q.dm().add(k)}y.debugSettings.path!==!1&&(j=new v.Shape,y.$20x&&(j.setPoints(y.$20x),j.s("shape.border.color","red"),j.s("shape.border.width",1),j.s("2d.editable",!1),j.s("2d.selectable",!1),j.s("shape.background",null),y._debugInfo||(y._debugInfo={}),y._debugInfo.path=j,q.dm().add(j)))}}},B.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},B.prototype.$22x=function(){var J=this;if(J._debugInfo){var r=J._debugInfo.grid,B=J._debugInfo.path,z=J.gv;r&&z.dm().remove(r),B&&z.dm().remove(B),J._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);