!function(J){"use strict";var I=J.ht,_=I.Default,w=_.getInternal(),D=w.ui(),l=null,d="__segmentLengths",Z="__lineTotalLength",G="__linePoints",H="__distance0",A="flow.count",m="flow.step",$="flow.element.max",c="flow.element.count",L="flow.element.min",R="flow.element.space",n="flow.element.autorotate",V="flow.element.background",j="flow.element.shadow.max",s="flow.element.shadow.min",K="flow.element.shadow.begincolor",W="flow.element.shadow.endcolor",M="flow.element.shadow.visible",Q="flow.element.image",i="flow",h=I.Math.Vector2,z=new h;new h,new h,I.List;var U=I.Default._edgeProtectMethod,t=U.getStraightLinePoints,Y=function(i,u){for(var d=[],s=i.length,w=0;s>w;w++){var m=i[w];m._as&&(m=m._as);for(var c=m[0],$=1;$<m.length;$++)d.push([c,m[$]]),c=m[$]}for(var z=[],w=0;w<d.length;w++){var E=f(d[w][0],d[w][1],u);z.push(E)}return{distance:z,segments:d}},p=function(a,x,p){if(a){for(var z,X=Y(a,x),Q=X.distance,L=X.segments,r=1/0,i=null,c=0,t=Q.length;t>c;c++){var F=Q[c];F.z<r&&(z=c,r=F.z,i=F)}if(null==p&&(p=.1),i.z<p){for(var n=0,y=0;z>=y;y++)n+=_.getDistance(L[y][0],z>y?L[y][1]:i);return n}}},f=function(i,x,Y){var A=i.x,a=i.y,V=x.x,j=x.y,R=Y.x,p=Y.y,m=V-A,N=j-a,t=Math.sqrt(m*m+N*N),c=m/t,$=N/t,X=(-A+R)*c+(-a+p)*$,w={x:A+X*c,y:a+X*$};return w.x>=Math.min(i.x,x.x)&&w.x<=Math.max(i.x,x.x)&&w.y>=Math.min(i.y,x.y)&&w.y<=Math.max(i.y,x.y)||(w.x=Math.abs(w.x-i.x)<Math.abs(w.x-x.x)?i.x:x.x,w.y=Math.abs(w.y-i.y)<Math.abs(w.y-x.y)?i.y:x.y),m=R-w.x,N=p-w.y,w.z=Math.sqrt(m*m+N*N),w},F=function(J,F){if(J){var z=Y(J,F).distance,h=1/0,G=null;return z.forEach(function(r){r.z<h&&(h=r.z,G=r)}),G}},B=U.calculateLineLength,o=U.calcSegmentIndexByDistance,k=U.calculatePointAlongLine,a=function(U,w,E){if(!U)return E;if(0===w){var i=U[0][0],x=U[0][1];return E+Math.atan2(x.y-i.y,x.x-i.x)}if(100===w){U=U[U.length-1];var i=U[U.length-2],x=U[U.length-1];return E+Math.atan2(x.y-i.y,x.x-i.x)}for(var d=0,c=[],G=U.length,e=0;G>e;e++){var n=U[e],K=B(n);d+=K,c.push(K)}for(var j=d*w/100,J=o(j,c),z=0,P=0;J>P;P++)z+=c[P];j-=z;for(var C=k(U[J],j),p=U[J],b=0,f=0,v=0;v<p.length-1;v++){var q=p[v],L=p[v+1],S=L.x-q.x,I=L.y-q.y,V=Math.sqrt(S*S+I*I);if(b+=V,b>j){f=v;break}}var Z=p[f];return E+Math.atan2(C.y-Z.y,C.x-Z.x)},C=function(i){var d=0;if(i)if(Array.isArray(i[0]))for(var J=i.length,N=0;J>N;N++){var t=i[N],g=B(t);d+=g}else d=B(i);return d},u=function(J,Z,H,U){return z.set(Z,H).rotateAround(null,U),J?{x:J.x+z.x,y:J.y+z.y}:{x:z.x,y:z.y}},S=function(L){var w=L._data,D=t(L);if(D){w.s("flow.reverse")&&(D.reverse(),D.forEach(function(e){e.reverse()}));for(var T=0,y=[],J=D.length,E=0;J>E;E++){var k=D[E],O=B(k);T+=O,y.push(O)}if(w[d]=y,w[Z]=T,w[G]=D,w instanceof I.Edge){var g=_.unionPoint(D),V=g.x+g.width/2,n=g.y+g.height/2;w.$10e={x:V,y:n}}e(L,!0)}},T=U.getPercentPosition,e=function(O,X){var S=O._data,Q=S[Z],E=S.s(A),x=S.s(m),q=0,K=S[d],v=S.s($),y=S.s(L),G=S.s(c),P=(v-y)/(G-1),e=[];if(K){if(1===G)e.push(v);else if(2===G)e.push(v),e.push(y);else{if(!(G>2))return;e.push(v);for(var D=G-2;D>0;D--)e.push(y+P*D);e.push(y)}var N=0,r=0;e.forEach(function(T){G-1>N&&(r+=S.getFlowElementSpace(T)),N++}),r+=(v+y)/2,q=(Q-E*r+r)/E;var s=O[H];for(null==s&&(s=0),X||(s+=x);s>Q+r;){var b=O._overCount;b?b++:b=1,b>=E&&(b=null),O._overCount=b,S.s("flow.autoreverse")?b?s-=q+r:(s=0,S.s("flow.reverse",!S.s("flow.reverse"))):s-=q+r}O[H]=s}},E="prototype",N=I.graph.GraphView[E],x=I.Data[E],y=D.DataUI[E],v=D.ShapeUI[E],P=D.EdgeUI[E],r=I.DataModel[E],X=I.Style;X[$]==l&&(X[$]=7),X[L]==l&&(X[L]=0),X[A]==l&&(X[A]=1),X[m]==l&&(X[m]=3),X[c]==l&&(X[c]=10),X[R]==l&&(X[R]=3.5),X[n]==l&&(X[n]=!1),X[V]==l&&(X[V]="rgba(255, 255, 114, 0.4)"),X[K]==l&&(X[K]="rgba(255, 255, 0, 0.3)"),X[W]==l&&(X[W]="rgba(255, 255, 0, 0)"),X[M]==l&&(X[M]=1),X[j]==l&&(X[j]=22),X[s]==l&&(X[s]=4),N.calculatePointLength=function(n,G,h){var $=this.getDataUI(n),A=t($);return p(A,G,h)},_.calculatePointLength=function(O,Z,Q,B){var K=t(l,O,Z);return p(K,Q,B)},_.calculateClosestPointOnLine=f,N.calculateClosestPoint=function($,U){var D=this.getDataUI($),Q=t(D);return F(Q,U)},_.calculateClosestPoint=function(f,H,T){var p=t(l,f,H);return F(p,T)},N.getPercentAngle=function(G,r){var p=this.getDataUI(G),D=t(p);return G.getRotation?G.getRotation():0,a(D,r,G.getRotation?G.getRotation():0)},_.getPercentAngle=function(R,f,c){var z=t(l,R,f);return a(z,c,0)},N.calculateLength=function(F){var p=this.getDataUI(F),S=t(p);return C(S)},_.calculateLength=function(T,E){var w=t(l,T,E);return C(w)},N.getPercentPosition=function(M,R){var p=this.getDataUI(M),s=t(p);return T(s,R)},_.getPercentPositionOnPoints=function(w,W,o){var H=t(l,w,W);return T(H,o)};var g=function(T){var z=T.data,d=this.dm();if(z&&"add"===T.kind){var W=d.$3e;W&&z.s(i)&&W.indexOf(z)<0&&W.push(z)}"clear"===T.kind&&(d.$3e=[])},q=function(X){var J=X.property,e=X.data,U=X.newValue,B=this.dm().$3e;if(B&&"s:flow"===J)if(U)B.indexOf(e)<0&&B.push(e);else for(var i=B.length,I=0;i>I;I++)if(B[I]===e){B.splice(I,1);break}},O=N.setDataModel;N.setDataModel=function(c){var n=this,C=n._dataModel;if(C!==c){C&&(C.umm(g,n),C.umd(q,n),C.$3e=[]),c.mm(g,n),c.md(q,n);var s=c.$3e=[];c.each(function(D){D.s(i)&&s.indexOf(D)<0&&s.push(D)}),O.call(n,c)}},x.getFlowElementSpace=function(){return this.s(R)};var b=function(S){var y=this,V=y._data,C=V[Z],r=V[d],E=V[G],I=V.s(A),D=0,a=y[H],J=V.s($),i=V.s(L),U=V.s(c),K=V.s(s),Y=V.s(j),M=V.s(n),Q=(Y-K)/(U-1),v=(J-i)/(U-1),W=V.getRotation?V.getRotation():0,w=V.getPosition?V.p():V.$10e,X=[],q=[];if(a!=l){if(1===U)X.push(J);else if(2===U)X.push(J),X.push(i);else{if(!(U>2))return;X.push(J);for(var z=U-2;z>0;z--)X.push(i+v*z);X.push(i)}if(1===U)q.push(Y);else if(2===U)q.push(Y),q.push(K);else{if(!(U>2))return;q.push(Y);for(var z=U-2;z>0;z--)q.push(K+Q*z);q.push(K)}var O=0,e=0;X.forEach(function(j){U-1>O&&(e+=V.getFlowElementSpace(j)),O++}),e+=(J+i)/2,D=(C-I*e+e)/I,S.save();for(var z=0;I>z;z++){var B=a,t=0,T=y._overCount,R=0;V.s("flow.autoreverse")&&T&&T>I-(z+1)||(B-=z*(D+e),O=0,X.forEach(function(T){var s=B-t;if(s>=0&&C>s){var F=!0,m=o(s,r);R=0;for(var b=0;m>b;b++)R+=r[b];if(s-=R,F){var D=k(E[m],s),d=W;if(M){for(var i=E[m],Q=0,P=0,I=0;I<i.length-1;I++){var x=i[I],h=i[I+1],z=h.x-x.x,c=h.y-x.y,a=Math.sqrt(z*z+c*c);if(Q+=a,Q>s){P=I;break}}var H=i[P];d+=Math.atan2(D.y-H.y,D.x-H.x)}W&&(D=u(w,D.x-w.x,D.y-w.y,W)),y.$5e(S,D,T,q[O],d)}}t+=V.getFlowElementSpace(X[O]),O++}))}S.restore()}},Qb=P._80o;P._80o=function(P){Qb.call(this,P);var p=this,G=p._data,Y=p.gv;G.s(i)&&Y.$7e!=l&&b.call(p,P)};var Qj=v._80o;v._80o=function(H){Qj.call(this,H);var C=this,U=C._data,D=C.gv;U.s(i)&&D.$7e!=l&&b.call(C,H)};var gr=P._79o,Hi=v._79o,ts=function(){var X=this,U=X._data,D=U.s($),o=!1,F=l;if(X._6I||(o=!0),F=U instanceof I.Edge?gr.call(X):Hi.call(X),U.s(i)&&o){var q=U.s(j),T=U.s(M);T&&q>D&&(D=q),D>0&&_.grow(F,Math.ceil(D/2)),S(X)}return!U.s(i)&&o&&(U[d]=U[Z]=U[G]=X[H]=l),F};v._79o=ts,P._79o=ts,y.$5e=function(v,j,U,g,N){var B=this,f=B._data,y=B.gv,E=f.s(V),n=f.s(K),S=f.s(W),c=f.s(M),o=y.$8e,d=f.s(Q);if(o==l&&(o=y.$8e={}),v.beginPath(),d!=l){var D=_.getImage(d),x=U/2;v.translate(j.x,j.y),v.rotate(N),v.translate(-j.x,-j.y),_.drawImage(v,D,j.x-x,j.y-x,U,U,f),v.translate(j.x,j.y),v.rotate(-N),v.translate(-j.x,-j.y)}else if(y.__flowBatch){var u=y.__flowBatchGroup;u||(u=y.__flowBatchGroup={});var G=[j.x,j.y,U/2];u[E]?u[E].push(G):u[E]=[G]}else v.fillStyle=E,v.arc(j.x,j.y,U/2,0,2*Math.PI,!0),v.fill();if(c){var J=22,P=J+"_"+n+"_"+S,s=o[P];if(s==l){var t=document.createElement("canvas");w.setCanvas(t,J,J);var b=t.getContext("2d"),k=J/2,I=k,q=k;w.translateAndScale(b,0,0,1),b.beginPath();var p=b.createRadialGradient(I,q,0,I,I,k);p.addColorStop(0,n),p.addColorStop(1,S),b.fillStyle=p,b.arc(I,q,k,0,2*Math.PI,!0),b.fill(),s=o[P]=t}var x=g/2;_.drawImage(v,s,j.x-x,j.y-x,g,g,f)}},N.$9e=function(){var Q=this,r=Q.dm().$3e;Q._24I,r.forEach(function(K){Q._24I[K._id]=K}),Q.iv()};var Hf=r.prepareRemove;r.prepareRemove=function(b){Hf.call(this,b);var G=b._dataModel,R=G.$3e;if(R)for(var h=R.length,d=0;h>d;d++)if(R[d]===b){R.splice(d,1);break}},N.setFlowInterval=function(_){var p=this,W=p.$11e;p.$11e=_,p.fp("flowInterval",W,_),p.$7e!=l&&(clearInterval(p.$7e),delete p.$7e,p.enableFlow(_))},N.getFlowInterval=function(){return this.$11e},N.enableFlow=function(h){var R=this,b=R.dm(),x=b.$3e;R.$7e==l&&(x.forEach(function(z){var X=R.getDataUI(z);S(X)}),R.$7e=setInterval(function(){b.$3e.forEach(function(t){e(R.getDataUI(t))}),R.$9e()},h||R.$11e||50))},N.disableFlow=function(){var _=this;clearInterval(_.$7e),delete _.$7e;var p=_.dm().$3e;p&&_.$9e()};var od=function(){this.__flowBatchGroup={}},jj=function(P){var v=this.__flowBatchGroup;if(v){P.save();for(var t in v){P.fillStyle=t,P.beginPath();var Z=v[t];Z.forEach(function(a){P.moveTo(a[0],a[1]),P.arc(a[0],a[1],a[2],0,2*Math.PI,!0)}),P.fill()}P.restore()}};N.setFlowBatch=function(C){var F=this;!!F.__flowBatch!=!!C&&(F.__flowBatch=C,C?(F.addBottomPainter(od),F.addTopPainter(jj)):(F.removeBottomPainter(od),F.removeTopPainter(jj)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);