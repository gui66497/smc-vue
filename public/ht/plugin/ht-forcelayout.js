!function(P,t){"use strict";var R="ht",s=R+".layout.",b=P[R]||module.parent.exports.ht,V=b.List,S=b.DataModel,H=b.Node,G=b.Edge,O=b.Group,A=Math,q=A.sqrt,p=A.random,C=A.max,F=A.min,f=function(e){return e*e};b.Default.getInternal().addMSMap({ms_force:function(c){c._interval=50,c._stepCount=10,c._motionLimit=.01,c._edgeRepulsion=.65,c._nodeRepulsion=.65,c._damper=1,c._maxMotion=0,c._motionRatio=0,c.init=function(b){var M=this;b instanceof S?M.dm=b:M.gv=b,M._nodeMap={},M._nodes=new V,M._edges=new V},c.start=function(){var y=this,c=y.gv;if(!y._timer){var G=y.cdm=c?c.dm():y.dm;G.mm(y.handleDataModelChange,y),G.md(y.handleDataPropertyChange,y),c&&c.mp(y.handleGV,y),G.each(function(T){if(y.isVisible(T)&&y.isLayoutable(T)&&T instanceof H)if(y instanceof l){var i=T.p3();T.p3([i[0]+p(),i[1]+p(),i[2]+p()])}else i=T.p(),T.p(i.x+p(),i.y+p())}),y._timer=setInterval(function(){y.relax()},y._interval),y._damper=1}},c.stop=function(){var P=this;P._timer&&(P.cdm.umm(P.handleDataModelChange,P),P.cdm.umd(P.handleDataPropertyChange,P),P.gv&&P.gv.ump(P.handleGV,P),clearInterval(P._timer),delete P._timer,delete P.cdm)},c.handleGV=function(R){var W=this;if("dataModel"===R.property){var J=R.oldValue,L=R.newValue;J&&(J.umm(W.handleDataModelChange,W),J.umd(W.handleDataPropertyChange,W)),this.cdm=L,L.mm(W.handleDataModelChange,W),L.md(W.handleDataPropertyChange,W)}},c.relax=function(){var F=this;if(!(F._damper<.1&&F._maxMotion<F._motionLimit)){this.cdm.each(function(Y){F.isVisible(Y)&&(Y instanceof G?F.addEdge(Y):Y instanceof H&&F.addNode(Y))});for(var c,r,C=0,P=F._edges,a=F._nodes,e=a.size();C<F._stepCount;C++){for(P.each(F.relaxEdge,F),c=0;e>c;c++)for(r=0;e>r;r++)F.relaxNode(a.get(c),a.get(r));F.moveNode()}F._isAdjusting=1,a.each(function(w){w.fix||(w.p?w.v.p3(w.p):w.v.p(w.x,w.y))}),delete F._isAdjusting,F._nodeMap={},a.clear(),P.clear(),F.onRelaxed()}},c.onRelaxed=function(){},c.isRunning=function(){return!!this._timer},c.isVisible=function(C){return C.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(C):!0},c.isLayoutable=function(u){if(u.s("layoutable")===!1)return!1;if(u instanceof O)return!1;var A=this;return A.gv?A.gv.isMovable(u)&&!A.gv.isSelected(u):!(A.cdm||A.dm).sm().co(u)},c.getNodeRepulsion=function(){return this._nodeRepulsion},c.setNodeRepulsion=function(x){this._nodeRepulsion=x,this._damper=1},c.getEdgeRepulsion=function(){return this._edgeRepulsion},c.setEdgeRepulsion=function(C){this._edgeRepulsion=C,this._damper=1},c.getStepCount=function(){return this._stepCount},c.setStepCount=function(R){this._stepCount=R,this._damper=1},c.getInterval=function(){return this._interval},c.setInterval=function(i){var $=this;$._interval!==i&&($._interval=i,$._timer&&(clearInterval($._timer),$._timer=setInterval(function(){$.relax()},i)))},c.handleDataPropertyChange=function(w){!this._isAdjusting&&this.isVisible(w.data)&&(this._damper=1)},c.handleDataModelChange=function(){this._damper=1},c.damp=function(){var P=this._maxMotion,o=this._damper;this._motionRatio<=.001&&((.2>P||P>1&&.9>o)&&o>.01?this._damper-=.01:.4>P&&o>.003?this._damper-=.003:o>1e-4&&(this._damper-=1e-4)),P<this._motionLimit&&(this._damper=0)}}}),b.layout.ForceLayout=function(f){this.init(f)},b.Default.def(s+"ForceLayout",t,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(f){this._limitBounds=f,this._damper=1},getNodeSize:function(G){var j=this.gv;return j&&j.getDataUIBounds?j.getDataUIBounds(G):G.getRect()},addNode:function(t){var b=this,z=b._nodeMap[t._id];if(z)return z;var M=t.p();z={v:t,x:M.x,y:M.y,dx:0,dy:0,fix:!b.isLayoutable(t),s:b.getNodeSize(t)};var O=z.s,p=q(f(O.width)+f(O.height))*b._nodeRepulsion;return z.r=1>p?100:p,b._nodeMap[t._id]=z,b._nodes.add(z),z},addEdge:function(i){if(i._40I&&i._41I){var R=this,j=R.addNode(i._40I),x=R.addNode(i._41I),S={s:j,t:x};x=x.s,j=j.s;var Z=x.width+j.width,F=x.height+j.height;S.length=q(Z*Z+F*F)*R._edgeRepulsion,S.length<=0&&(S.length=100),R._edges.add(S)}},relaxEdge:function(p){var y=p.t,w=p.s,m=y.x-w.x,k=y.y-w.y,H=q(m*m+k*k),O=100*p.length,u=.25*m/O*H,Y=.25*k/O*H;y.dx=y.dx-u,y.dy=y.dy-Y,w.dx=w.dx+u,w.dy=w.dy+Y},relaxNode:function(U,g){if(U!==g){var e=0,q=0,A=U.x-g.x,S=U.y-g.y,t=A*A+S*S;0===t?(e=p(),q=p()):36e4>t&&(e=A/t,q=S/t);var G=U.r*g.r/400;e*=G,q*=G,U.dx+=e,U.dy+=q,g.dx-=e,g.dy-=q}},moveNode:function(){var M=this,d=M._limitBounds,x=M._maxMotion,O=0,T=M._damper;M._nodes.each(function(L){if(!L.fix){var R=L.dx*T,U=L.dy*T;if(L.dx=R/2,L.dy=U/2,O=C(q(R*R+U*U),O),L.x+=C(-40,F(40,R)),L.y+=C(-40,F(40,U)),d){L.x<d.x&&(L.x=d.x,M.adjust(1,0)),L.y<d.y&&(L.y=d.y,M.adjust(0,1));var u=L.s;L.x+u.width>d.x+d.width&&(L.x=d.x+d.width-u.width,M.adjust(-1,0)),L.y+u.height>d.y+d.height&&(L.y=d.y+d.height-u.height,M.adjust(0,-1))}}}),M._maxMotion=O,M._motionRatio=O>0?x/O-1:0,M.damp()},adjust:function(T,S){var Q=this._limitBounds;this._nodes.each(function(g){T>0?(!Q||g.x+g.s.width+T<Q.x+Q.width)&&(g.x+=T):(!Q||g.x+T>Q.x)&&(g.x+=T),S>0?(!Q||g.y+g.s.height+S<Q.y+Q.height)&&(g.y+=S):(!Q||g.y+S>Q.y)&&(g.y+=S)})}});var l=b.layout.Force3dLayout=function(E){this.init(E)};b.Default.def(s+"Force3dLayout",t,{ms_force:1,getNodeSize3d:function(l){return l.s3()},addNode:function(P){var c=this,t=c._nodeMap[P._id];if(t)return t;t={v:P,p:P.p3(),d:[0,0,0],fix:!c.isLayoutable(P),s:c.getNodeSize3d(P)};var C=t.s,k=b.Default.getDistance(C)*c._nodeRepulsion;return t.r=1>k?100:k,c._nodeMap[P._id]=t,c._nodes.add(t),t},addEdge:function(L){if(L._40I&&L._41I){var R=this,i=R.addNode(L._40I),W=R.addNode(L._41I),I={s:i,t:W};W=W.s,i=i.s,I.length=q(f(W[0]+i[0])+f(W[1]+i[1])+f(W[2]+i[2]))*R._edgeRepulsion,I.length<=0&&(I.length=100),R._edges.add(I)}},relaxEdge:function(K){var x=K.t.p,B=K.s.p,z=K.t.d,N=K.s.d,c=x[0]-B[0],R=x[1]-B[1],G=x[2]-B[2],g=q(c*c+R*R+G*G),M=100*K.length,S=.25*c/M*g,H=.25*R/M*g,u=.25*G/M*g;z[0]-=S,z[1]-=H,z[2]-=u,N[0]+=S,N[1]+=H,N[2]+=u},relaxNode:function(B,U){if(B!==U){var k=B.p,d=U.p,m=0,h=0,X=0,E=k[0]-d[0],N=k[1]-d[1],x=k[2]-d[2],j=E*E+N*N+x*x;0===j?(m=p(),h=p(),X=p()):216e6>j&&(m=E/j,h=N/j,X=x/j);var Q=B.r*U.r/400,I=B.d,T=U.d;m*=Q,h*=Q,X*=Q,I[0]+=m,I[1]+=h,I[2]+=X,T[0]-=m,T[1]-=h,T[2]-=X}},moveNode:function(){var K=this,B=K._maxMotion,T=0,Z=K._damper;K._nodes.each(function(H){if(!H.fix){var G=H.p,n=H.d,r=n[0]*Z,D=n[1]*Z,f=n[2]*Z;n[0]=r/2,n[1]=D/2,n[2]=f/2,T=C(q(r*r+D*D+f*f),T),G[0]+=C(-40,F(40,r)),G[1]+=C(-40,F(40,D)),G[2]+=C(-40,F(40,f))}}),K._maxMotion=T,K._motionRatio=T>0?B/T-1:0,K.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);